---
title: 'Towards a statistical measure for durable solutions to internal displacement:
  a simulation to assess indicator and metric choice'
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  word_document:
    toc: yes
  pdf_document:
    toc: yes
    keep_tex: no
    fig_caption: yes
    latex_engine: pdflatex
    template: design/preamble.tex
linkcolor: blue!50!black
link-citations: yes
geometry: margin=1in
fontsize: 11pt
spacing: single
---

```{r setup, include=FALSE}
library(tidyverse)
library(hrbrthemes)
library(patchwork)
library(kableExtra)
library(DiagrammeR)
knitr::opts_chunk$set(echo = F, message = F, warning = F, results = 'asis', cache = T, fig.align="center")
```

```{r nigeria_targets}
DS_Original_nigeria <- targets::tar_read("DS_Original_nigeria") %>% select(-Durable_Solutions)
DS_Option2_nigeria <- targets::tar_read("DS_Option2_nigeria") %>% select(-Durable_Solutions)
DS_Option3_nigeria <- targets::tar_read("DS_Option3_nigeria") %>% select(-Durable_Solutions)
DS_Option4_nigeria <- targets::tar_read("DS_Option4_nigeria") %>% select(-Durable_Solutions)
DS_Option5_nigeria <- targets::tar_read("DS_Option5_nigeria") %>% select(-Durable_Solutions)
DS_Option1_nigeria <- targets::tar_read("DS_Option1_nigeria") %>% select(-Durable_Solutions)
DS_Option4b_nigeria <- targets::tar_read("DS_Option4b_nigeria") %>% select(-Durable_Solutions)

DS_Original_nohlp_nigeria <- targets::tar_read("DS_Original_nohlp_nigeria") %>% select(-Durable_Solutions)
DS_Option1_nohlp_nigeria <- targets::tar_read("DS_Option1_nohlp_nigeria") %>% select(-Durable_Solutions)
DS_Option2_nohlp_nigeria <- targets::tar_read("DS_Option2_nohlp_nigeria") %>% select(-Durable_Solutions)
DS_Option3_nohlp_nigeria <- targets::tar_read("DS_Option3_nohlp_nigeria") %>% select(-Durable_Solutions)
DS_Option4_nohlp_nigeria <- targets::tar_read("DS_Option4_nohlp_nigeria") %>% select(-Durable_Solutions)
DS_Option5_nohlp_nigeria <- targets::tar_read("DS_Option5_nohlp_nigeria") %>% select(-Durable_Solutions)

```

```{r hargeisa_targets}
DS_Original_hargeisa <- targets::tar_read("DS_Original_hargeisa") %>% select(-Durable_Solutions)
DS_Option1_hargeisa <- targets::tar_read("DS_Option1_hargeisa") %>% select(-Durable_Solutions)
DS_Option2_hargeisa <- targets::tar_read("DS_Option2_hargeisa") %>% select(-Durable_Solutions)
DS_Option3_hargeisa <- targets::tar_read("DS_Option3_hargeisa") %>% select(-Durable_Solutions)
DS_Option4_hargeisa <- targets::tar_read("DS_Option4_hargeisa") %>% select(-Durable_Solutions)
DS_Option4b_hargeisa <- targets::tar_read("DS_Option4b_hargeisa") %>% select(-Durable_Solutions)
DS_Option5_hargeisa <- targets::tar_read("DS_Option5_hargeisa") %>% select(-Durable_Solutions)

DS_Original_nohlp_hargeisa <- targets::tar_read("DS_Original_nohlp_hargeisa") %>% select(-Durable_Solutions)
DS_Option1_nohlp_hargeisa <- targets::tar_read("DS_Option1_nohlp_hargeisa") %>% select(-Durable_Solutions)
DS_Option2_nohlp_hargeisa <- targets::tar_read("DS_Option2_nohlp_hargeisa") %>% select(-Durable_Solutions)
DS_Option3_nohlp_hargeisa <- targets::tar_read("DS_Option3_nohlp_hargeisa") %>% select(-Durable_Solutions)
DS_Option4_nohlp_hargeisa <- targets::tar_read("DS_Option4_nohlp_hargeisa") %>% select(-Durable_Solutions)
DS_Option5_nohlp_hargeisa <- targets::tar_read("DS_Option5_nohlp_hargeisa") %>% select(-Durable_Solutions)
```


```{r sudan_targets}
DS_Original_nohlp_sudan <- targets::tar_read("DS_Original_nohlp_sudan") %>% select(-Durable_Solutions)
DS_Option1_nohlp_sudan <- targets::tar_read("DS_Option1_nohlp_sudan") %>% select(-Durable_Solutions)
DS_Option2_nohlp_sudan <- targets::tar_read("DS_Option2_nohlp_sudan") %>% select(-Durable_Solutions)
DS_Option3_nohlp_sudan <- targets::tar_read("DS_Option3_nohlp_sudan") %>% select(-Durable_Solutions)
DS_Option4_nohlp_sudan <- targets::tar_read("DS_Option4_nohlp_sudan") %>% select(-Durable_Solutions)
DS_Option5_nohlp_sudan <- targets::tar_read("DS_Option5_nohlp_sudan") %>% select(-Durable_Solutions)

```

```{r colombia_targets}
#DS_Original_colombia_ind <- targets::tar_read("DS_Original_colombia_ind") %>% select(-Durable_Solutions)
#DS_Option2_colombia_ind <- targets::tar_read("DS_Option2_colombia_ind") %>% select(-Durable_Solutions)
#DS_Option3_colombia_ind <- targets::tar_read("DS_Option3_colombia_ind") %>% select(-Durable_Solutions)
#DS_Option4_colombia_ind <- targets::tar_read("DS_Option4_colombia_ind") %>% select(-Durable_Solutions)
#DS_Option5_colombia_ind <- targets::tar_read("DS_Option5_colombia_ind") %>% select(-Durable_Solutions)
#DS_Option1_colombia_ind <- targets::tar_read("DS_Option1_colombia_ind") %>% select(-Durable_Solutions)


DS_Original_colombia_hh <- targets::tar_read("DS_Original_colombia_hh") %>% select(-Durable_Solutions)
DS_Option2_colombia_hh <- targets::tar_read("DS_Option2_colombia_hh") %>% select(-Durable_Solutions)
DS_Option3_colombia_hh <- targets::tar_read("DS_Option3_colombia_hh") %>% select(-Durable_Solutions)
DS_Option4_colombia_hh <- targets::tar_read("DS_Option4_colombia_hh") %>% select(-Durable_Solutions)
DS_Option5_colombia_hh <- targets::tar_read("DS_Option5_colombia_hh") %>% select(-Durable_Solutions)
DS_Option1_colombia_hh <- targets::tar_read("DS_Option1_colombia_hh") %>% select(-Durable_Solutions)
```

\newpage 

# Executive summary 

**Background and problem statement:** The *International Recommendations on IDP Statistics*, developed by the *Expert Group on Refugee and IDP Statistics*, propose a “solutions measure” to count the exit of internally displaced persons from the official stock of IDPs for the purpose of aggregate statistics ([Overview on the solutions measure](#the-iris-solutions-measure)). Displaced households should exit the stock of IDPs if they overcome their vulnerabilities on 10 prioritised sub-criteria and if they perform as well or even better than the host community/national average on these dimensions. However, more evidence is needed to develop a fully applicable “solutions measure” that is sensitive to key displacement-related vulnerabilities while allowing for a meaningful comparison between displaced and non-displaced populations: EGRIS has to select the statistical indicators to measure the 10 sub-criteria  ([Challenge of indicator selection](#addressing-the-selection-of-statistical-indicators)) and has to define a metric that allows to combine these statistical indicators for comparison with host/national benchmarks ([Challenge of metric selection](#adressing-the-selection-of-a-statistical-metric)). Beyond these central challenges, the report provides a list of [additional challenges](#remaining-methodological-challenges) that should be addressed from a statistical/methodological perspective to fully implement the "solutions measure" (i.e. the exit of IDPs from the overall stock). 

\bigskip 

\noindent\textbf{Methodological approach:} This [simulation-based study](#methodology) assesses to what extent the selection of indicators and metric options affect the number of IDPs exiting the stock on average across 4 displacement contexts. The note introduces [5 potential metric options](#adressing-the-selection-of-a-statistical-metric) for the “solutions measure”, ranging from composite metrics at the sub-criterion, criterion or the aggregated level to regression-based and cell-based approaches. The note also explores the [universe of potential indicators](#step-1-identifiying-the-universe-of-potential-indicators) to measure the 10 sub-criteria based on the Durable Solutions Library in Colombia, Hargeisa, Sudan, and Nigeria. Simulations that iterate through each possible indicator combination and metric option in each country context allow to assess how the metric selection and indicator selection affects the performance of the “solutions measure”. 

\bigskip 

\noindent\textbf{Key findings and recommendations} 

\noindent The simulations show that the selection of a metric to implement a comparison between displaced and host communities/national averages is key as some metric options *by design* generate low exits from the IDP stock (regardless of the chosen indicators). Other metric options show high variability regarding the size of the IDP exit depending on the indicators chosen for the 10 sub-criteria. This pattern can be found across displacement contexts ([Country-by-country findings](#country-by-country-findings-on-indicator-and-metric-selection)). In general terms, the simulations demonstrate that the IRIS requirement for IDP households to achieve parity with the host community/national average on all 10 identified sub-criteria sets a very high threshold for exits from the stock and the requirements could be relaxed. 

\bigskip 

\noindent\textbf{Metric selection:} A *composite index across all 10 sub-criteria* and a *regression-based approach* display high variability depending on the chosen set of indicators and can exit small to large numbers of IDPs from the stock because the principle of overcoming key displacement-related vulnerabilities on all 10 sub-criteria is not applied. *Composite indices on the sub-criterion level*, that combine multiple indicators for each sub-criterion, have high data demands and limit the number of IDPs exiting from the stock by design. Similarly, splitting IDP populations into *homogeneous cells* based on population characteristics and comparing those cells to the benchmark generates few exits from the IDP stock. Composite indices on the sub-criterion level and homogeneous cells are less sensitive to the selection of statistical indicators as it is hard to achieve a pass on all 10 sub-criteria regardless of the chosen set of indicators. Finally, *composite indices at the criterion level* generate medium to lower level exits from the IDP stock but relax the IRIS requirement that IDPs must perform en par with non-displaced households on all 10 sub-criteria. 

Overall, the report highlights the need for EGRIS to narrow down the possible metric options in light of the empirical evidence provided ([Summary of metrics findings](#informing-the-selection-of-a-metric)). During the development of the solutions measure, it will also be crucial to address other outstanding challenges for the metric design (i.e. dealing with statistical uncertainty in the benchmark values, defining the comparator population, addressing changing benchmarks over time, specifying how assistance is factored into the solutions measure).

\bigskip

![Summary of the available metric options\label{fig:summary}](design/Summary_metric.jpg){ width=95% }
\bigskip

\noindent\textbf{Indicator selection:} Regarding the selection of statistical indicators, the simulations demonstrate that the indicator selection matters for some metric options more than for others. In general, it is key that EGRIS selects indicators that are commonly available, standardized, follow high quality standards and maximize coverage in the IDP population ([Summary of indicator findings](#informing-the-selection-of-indicators)). Beyond these general guidelines, the report highlights 4 key areas to narrow down the set of indicators and improve the solutions measure:

1. Missing data for indicators: EGRIS could identify a clear and distinct strategy to deal with missing data by design in contrast to missing data due to non-response or missing data collections. The current recommendation is that missing data implies an IDP household cannot be assessed and should not exit the stock. However, non-applicability of a sub-criterion (e.g. school education for households without school-age children) should allow to exit a household from the stock. 

2. Household vs individual-level indicators: EGRIS could provide clearer guidelines on how data collected on the individual-level should be aggregated to household-level assessments for the purpose of the solutions measure. Several indicators, such as employment and education, tend to be individual-level characteristics. Guidelines on the aggregation of these indicators to the household-level will facilitate the application of the solutions measure in a diverse range of contexts. 

3. Solutions-oriented non-binary indicators: If EGRIS chooses non-binary indicators for the solutions measure, it should be clarified what constitutes a solution and how to treat metric and categorical indicators within the framework of the solutions measure. In particular categorical indicators raise new challenges to allow a comparison between IDPs and a benchmark and to clearly identify what constitutes the overcoming of displacement-related vulnerabilities. 

3. Revisions for specific indicators: EGRIS could reconsider the sub-criterion *4.1. Property restitution and compensation*. Indicators measuring the presence of property restitution mechanisms tend to drastically reduce the exit from IDP stocks as they are often unavailable. EGRIS could consider a focus on tenure rights or property documentation as alternative for this sub-criterion. Additionally, clarifications for the distinction between *3.1. Employment & livelihoods* and *3.2. Economic security* could enhance the usability of the solutions measure. 

The overall recommendation is that EGRIS narrows down the list of potential indicators by focusing on standardized indicators that are available in many contexts, that are clearly oriented towards solutions, and can be reliably collected with household- and individual-level data collections. 


\newpage

# Introduction

The *International Recommendations on IDP Statistics* (IRIS), developed by the *Expert Group on Refugee and IDP Statistics* (EGRIS), provide a framework for capturing a country's stock of IDPs for statistical purposes. To correctly calculate the stock, it is crucial to define when individuals enter the stock and when they exit the stock. This note relates to the latter, and specifically to the way by which individuals exit the stock by overcoming key displacement-related vulnerabilities - sometimes referred to colloquially as the "solutions measure". 

It is important to note that the purpose of a statistical definition for the "end of displacement" is explicitly **not** to identify specific households or individuals that are no longer displaced (e.g. for programming or assistance purposes) but only to enable aggregate statistics on the amount of internal displacement in each country that can be compared globally. Separate from the "solutions measure", IRIS also proposes a distinct but related framework to assess progress towards the achievement of durable solutions - colloquially referred to as the "progress measure". The progress measure aims to allow decision-makers "to understand at a glance in which aspects of vulnerability IDPs are struggling compared to others [...] and in which they are doing relatively well" (IRIS, page 55). While progress and solution can likely be measured with similar statistical indicators, their aims and application are very different: informing decisions on policy areas that need attention as well as more granular assistance-related decisions (through the IRIS progress measure) vs informing aggregate statistics on IDP stocks (IRIS solutions measure).  

This note focuses on the IRIS solutions measure and how this measure can be implemented in practice. The IRIS have advanced the debate on a statistical measure on solutions considerably, including in the following ways:

- Specification of 5 priority criteria and 10 priority sub-criteria that should form the basis of a statistical measure^[The definition of priority criteria and sub-criteria is relevant to the IRIS recommended progress and solutions measure as they should be based on a similar or the same set of indicators.] 
- Recommendation of quality criteria to assess the suitability of indicators to measure each sub-criterion
- Move to a context-dependent assessment of durable solutions rather than an absolute approach whilst maintaining a level of comparison
- Narrowing of benchmark options (to national averages or host community averages)

Nevertheless, as stated in the recommendations themselves, the above achievements do not result in a final and applicable statistical measure for solutions. The IRIS falls short of 1) specifying the selection of statistical indicators for each of the priority criteria/ sub-criteria and 2) identifying a fully workable methodology of combining these indicators into an overall statistical measure that can be compared to a national or host community benchmark. While other methodological issues may also need further attention (i.e. the final definition of a comparator group, addressing statistical uncertainty and missing data points), the aim of this technical note is to inform solutions to these two outstanding methodological challenges.  

This methodological note first outlines the solutions measure as suggested by the IRIS and demonstrates the remaining methodological challenges. The main body of the note then simulates how the selection of statistical indicators and the choice of a statistical framework to combine them affect the results of a solutions measure, i.e. the magnitude of exit from IDP stocks. To conduct these simulations, four empirical datasets from Hargeisa, Nigeria, Colombia and Sudan are used. The note compares how choosing different indicators and metrics to combine them increase or decrease the exit from the IDP stock in those countries. The note concludes with a summary of findings to improve the solutions metrics.  

# The IRIS "solutions measure"

Based on the *Framework for Durable Solutions by the Inter-Agency Standing Committee* (IASC), the IRIS specifies a set of 5 priority criteria and 10 sub-criteria that need to be measured in every displacement context to take IDPs out of the national stock as having overcome their displacement-related vulnerabilities (see Table \ref{tab:IASC}). The indicators for each of the 10 sub-criteria should be collected at the household or individual level.

```{r}
IASC <- data.frame(
  "Criteria" = c("1. Safety and security", " ",
                 "2. Adequate standard of living", " ", " "," ",
                 "3. Access to livelihoods", " ",
                 "4. Restoration of housing, land and property",
                 "5. Documentation"),
  "Subcriteria" = c("1.1 Victims of violence","1.2 Freedom of movement",
                     "2.1 Food security", "2.2 Shelter and housing", 
                     "2.3 Medical services", "2.4 Education",
                     "3.1 Employment and livelihoods", "3.2 Economic security",
                     "4.1 Property restitution and compensation", "5.1 Documentation")
)
knitr::kable(IASC,"latex", booktabs = TRUE,
             linesep = "",
             caption= "\\label{tab:IASC}IASC durable solution criteria and identified sub-criteria") %>%
  kable_styling(latex_options = "hold_position", font_size=10)
```

To then assess how many displaced households in a specific context have progressed towards a durable solution, the situation of IDPs must be compared with that of the comparator population (national average or "host community" average). The logic is that IDPs that perform similar or better than the comparator population are no longer considered displaced for the purpose of statistics.^[Note that this framework is used to count the aggregate number of IDPs in a given context. It is not used to assess the allocation of aid to an individual or household.] Regarding the methodology to decide whether a household has ended its displacement, IRIS writes: 

> *\footnotesize "The methodology used for calculating the composite measure is a simple pass/no pass (or binary) scenario at sub-criteria level that is then accumulated to produce a score at criteria level, and ultimately an overall score for the measure. [...] **To determine if a sub-criterion has been overcome or not, for each household, a target needs to be set** [...] It is foreseen that target setting will be more complex with categorical or binary indicators [...] If all sub-criteria receive a 'pass' mark, then that criterion [...] has been overcome. For criteria with multiple sub-criteria, **all sub-criteria would need to receive a 'pass' mark for the criteria to be overcome**. All of the five key-displacement related vulnerabilities (the five criteria) need to achieve a 'pass' mark for the composite measure to be fulfilled.[...] It is recommended to use the general/national population as the comparison group when deciding on the targets or thresholds for scoring each sub-criteria [...] In specific circumstances, thresholds can be set through a comparison with the average situation of a subset of the general population."* (IRIS, page 58-61) 

  Table \ref{tab:example} provides an example to understand the framework. Household A passes the criteria *1. Safety & security*, *4. Restoration of HLP rights*, and *5. Documentation*. However, because it has not passed the two sub-criteria in *3. Access to livelihood*, it does not pass this criterion. The household also does not pass the criterion *2. Adequate standard of living* because it has not passed the sub-criterion *2.4 Education* and the framework requires to pass all sub-criteria. Overall, no durable solution has been achieved in this example and the household should not exit the IDP stock.  

\begin{table}[htp!]
\centering
\footnotesize
\caption{Example household in the IRIS framework}
\label{tab:example}
\begin{tabular}{llll}
\toprule
& \multicolumn{2}{c}{Sub-criterion (compared to a benchmark)} & Result on criterion level \\
\midrule
\textbf{Household A} & 1.1 Victims of violence &  Pass & 2/2 (Passed) \\
&  1.2 Freedom of movement &  Pass & \\
  \cmidrule{2-4}
& 2.1 Food security & Pass & 3/4 (Not passed) \\
& 2.2 Shelter and housing &  Pass & \\
& 2.3 Medical services & Pass & \\
& 2.4 Education & No pass & \\
  \cmidrule{2-4}
& 3.1 Employment \& livelihoods  & No pass & 0/2 (Not passed) \\
& 3.2 Economic security & No pass & \\
  \cmidrule{2-4}
& 4.1 Property restitution \& compensation & Pass & 1/1 (Passed) \\
  \cmidrule{2-4}
& 5.1 Documentation & Pass & 1/1 (Passed) \\
\midrule
& \multicolumn{3}{l}{\textbf{Overall:} No durable solution achieved: displacement not ended} \\
\bottomrule
\end{tabular}
\end{table}

## Remaining methodological challenges

While this framework appears intuitive, there are several challenges and methodological gaps when implementing it in practice. 

The first methodological challenge is that **no set of statistical indicators has been agreed on to capture the 10 sub-criteria**. The lack of an agreed, measurable set of indicators presents a real challenge in operationalizing the IRIS framework. While this methodological assessment aims to shed some light on how specific indicators affect the exit from the IDP stock, further empirical work will be needed to assess how the indicator choice affects the aggregate stock of IDPs in a displacement context. Eventually, more suitable datasets will need to be produced to facilitate this. 

The second methodological challenge arises from the above-cited assumption that it is possible to set a comparator target/benchmark for each sub-criterion which a household needs to match or surpass. The IRIS states that “target setting will be more complex with categorical or binary indicators”; however, **such benchmark comparison is not just complex but indeed technically meaningless for binary and categorical indicators. Binary and categorical household-level data points cannot be directly compared with average/distribution values in the comparator population**. To illustrate this problem, imagine a binary indicator "household has access to medical services" was selected to operationalize sub-criterion *2.3 Medical services*. The value for any given household can only be yes or no, 1 or 0. The target value derived from the comparator population, in contrast, would be a percentage on a scale, let us assume 5% of the comparator population have access to medical services. Achieving a pass for any given household in comparison with the target value can only be achieved by achieving a "yes" in this indicator – despite the fact that access to medical services is extremely low in the comparator population. In effect, the value of the comparator population is irrelevant, because the condition for achieving a pass would not have changed if the comparator value had been, say, 1% or 90%.  In other words, the entire idea of a contextualized target/benchmark that underlies the IRIS approach is devalued for binary or categorical indicators. Unfortunately, such types of indicators appear the pragmatic and thematically most valid choice of metric under the vast majority of sub-criteria. 

A third methodological challenge not yet addressed by IRIS arises if the **comparator value comes with a level of statistical uncertainty**. Assume the benchmark value for the national/host population was produced using a sample survey – it would thereby come with a confidence interval around the comparator point estimate. It is not clear yet if a displaced household would have to perform as good as or better than the benchmark's point estimate or whether displaced households should "just" perform as good as or better than the lower bound of the confidence interval in the benchmark population. Deciding on an approach towards statistical uncertainty is crucial as the IDP stock estimates in most countries are not derived from a full mapping of the complete IDP population but from sampled surveys of displaced and non-displaced households. How to deal with levels of statistical uncertainty is relevant for binary but also metric indicators. 

Even if a set of statistical indicators can be agreed on to operationalize the 10 sub-criteria, it is unlikely that data will be available for all selected indicators in all situations. The IRIS specifies that if data is missing an assessment of whether displacement has been overcome cannot be made. Further empirical work provides an opportunity to assess and further explore the feasibility of this approach and gain greater insight on the aggregate **effects of missing data points** (and potentially of imputation-based methods for dealing with them).   

A fifth area left open by IRIS is the **definition of the comparator population** itself – national or "host". If a host community is to be used as comparator, a clear definition of the term will need to be developed. While it may be preferable for IRIS to *not* provide a standardized recommendation on this and leave flexibility to data producers, further empirical work is recommended to at least assess how the choice of the comparator population affects the aggregate results across different context, and facilitate an evidence-informed decision. 

Related to the definition of a comparator population is the question how to deal with **changing benchmark values over time**. If for example unemployment in the host community/ national population drops from one stock assessment to the next due to improving economic conditions in a country, this increases the benchmark value, and IDPs that have previously been taken out of the stock as having overcome their vulnerabilities may fall under the comparator benchmark again, re-entering and thereby enlarging the stock without the occurrence of new displacement-causing events. 

Finally, the IRIS solution measure should address to what extent assistance received should be "factored out / imputed out" before an assessment is made of how many IDPs exit the stock. For example, if IDPs overcome key-displacement related vulnerabilities because their shelter and housing is provided through humanitarian assistance, they may exit the stock without actually having overcome their housing-related vulnerabilities. While the solutions measure only produces an aggregate number, the measure should ensure that the overall exit from the IDP stock is not based on the **overcoming of vulnerabilities through humanitarian assistance** but through sustainable solutions.   

Box \ref{box:box1} summarizes the methodological challenges that need to be addressed to establish a workable solutions metrics. This note aims to advance the debate on the challenges 1 and 2.

\begin{story}[ht]
  \framedbox{
  \textbf{Challenge 1:} Specifying one or several statistical indicators for each of the 10 sub-criteria
  
  \textbf{Challenge 2:} Find a way to make the “contextualized” approach (comparing against 
          target/benchmark population) statistically applicable 

  \textbf{Challenge 3:} Address how to deal with statistical uncertainty in the target/benchmark       
                      values

  \textbf{Challenge 4:} Specify how missing data points should be dealt with
  
  \textbf{Challenge 5:} Define the comparator population
  
  \textbf{Challenge 6:} Address changing benchmark values over time
  
  \textbf{Challenge 7:} Specify how assistance is factored into the solutions measure
  }
  \caption[]{Remaining challenges for a workable solutions metrics}
  \label{box:box1}
\end{story}


## Addressing the selection of statistical indicators

One of the next steps to advance the solutions measure is to identify the indicators that should be used to measure the 10 sub-criteria for a durable solution ("challenge 1" above). The choice of the right indicators is complex. Political sensitivities, contextual differences between displacement situations, comparability across different contexts and comparator populations as well as availability of data to measure the indicators may play a role in the final decision to operationalize the 10 sub-criteria. According to IRIS, possible indicators should be **commonly used** (e.g. the indicator is required for SDG reporting); an indicator should be **tested and evaluated** to satisfy quality criteria and comply with international standards; and an indicator should **cover the population in question** (i.e. school enrolment is widely recognized as a good indicator for measuring access to education, but it would not give any information on IDP households which do not have children). 

While recommending the 'best' indicators to measure the 10 sub-criteria is beyond the scope of this note, this note takes an empirical approach to simulate how the choice of indicators affects the outcome of the solutions measure, that is the number of IDPs that would leave a national stock in different displacement contexts. Importantly, this is a technical assessment that generates practical information on 1) the extent to which the indicator choice for each sub-criterion matters and 2) the statistical characteristics or quality standards that an indicator should fulfil to be suitable from a statistical perspective.  This can inform dialogue on higher political levels on the right indicator choice, but it does not lead to a final set of indicators that should be used. 


## Addressing the selection of a statistical metric

Another necessary next step towards a full metric is to address how the different indicators are combined and then compared to the national population or the host community in a statistically applicable way ("challenge 2" in the above list). Different metrics, or combinations of indicators and comparisons with a benchmark population, are possible to implement the current IRIS solution measure. The overall aim is to be able to compare an IDP household to a benchmark on all 10 sub-criteria to decide whether a household performs the same or even better than the national average or the host community and should hence no longer be counted as IDP household in official statistics.  As this comparability is currently not technically applicable in the IRIS solutions metric, different options are available to revise the proposed measure: 

### Pass/fail measure: Implementing the IRIS without a comparator population^[For completeness and to allow comparisons with other metric options, this note also demonstrates simulations based on this approach but will not discuss the suitability of a pass/fail measure as option going forward.]

The current measure described in IRIS does not allow for a meaningful comparison between IDPs and host communities/national averages. One could make the decision to fully focus on a pass/fail decision on the sub-criterion level (as demonstrated in Table \ref{tab:example} above) by only assessing whether a household achieves the sub-criterion. This is not a desirable option because no comparison takes place, and it thereby fails to comply with the fundamental logic set out in IRIS for a solutions measure, which is that it should be assessed relative to a host/national benchmark. A consequence of a context-blind pass/fail approach is that this option is likely to produce very low numbers of IDPs overcoming their vulnerabilities because achieving a ‘one’ for all 10 indicators is a hard threshold in many displacement contexts.  

### Option 1: An actual composite metric across all criteria

The approach currently outlined in IRIS is described therein as a "composite" measure, which strictly speaking it is not, considering that a single indicator per sub-criterion is implicitly assumed and a pass needs to be achieved in each sub-criterion/indicator. One option to explore that aligns with the contextualized approach would be to redefine the overall framework as an actual composite index. A composite index groups together indicators across all criteria to one score (see an illustration in Table \ref{tab:option1}). This household level index could then be more readily compared to the average value of the same composite index in the comparator population. The shortcoming of this approach is that a household may be taken out of the IDP stock despite underperformance on a specific key criterion or sub-criterion (which is a deviation from the IRIS requirement that a pass needs to be achieved at the sub-criterion level). 

\begin{table}[!htp]
\caption{\label{tab:option1}Option 1: A full composite metric for all sub-criteria}
\centering
\footnotesize
\begin{tabular}[t]{llll}
\toprule
 & Sub-criteria & Indicator & \\
\midrule
Household A & 1.1 Victims of violence & Indicator 1.1.a & 1\\
 & 1.2 Freedom of movement & Indicator 1.2.a & 1\\
 & 2.1 Food security & Indicator 2.1.a & 1\\
 & 2.2 Shelter and housing & Indicator 2.2.a & 1\\
 & 2.3 Medical services & Indicator 2.3.a & 1\\
 & 2.4 Education & Indicator 2.4.a & 0\\
 & 3.1 Employment and livelihoods & Indicator 3.1.a & 0\\
 & 3.2 Economic security & Indicator 3.2.a & 0\\
 & 4.1 Property restitution and compensation & Indicator 4.1.a & 1\\
 & 5.1 Documentation & Indicator 5.1.a & 1\\
\midrule
 & Total composite index for the household &  & 7/10\\
 & Benchmark average &  & 8.6/10\\
 \midrule
\multicolumn{4}{l}{\rule{0pt}{1em}\textbf{Decision:} The household has not overcome displacement as the composite index is below the benchmark.}\\
\bottomrule
\end{tabular}
\end{table}

### Option 2: A set of composite indices at the criterion level

Rather than construct a single index across all criteria, one could define composite indices for each criterion (see Table \ref{tab:option2}). For example, the composite index for the criterion on *2. Adequate standard of living* could consist of four or more equally weighted indicators corresponding to the four related sub-criteria (*2.1. Food security, 2.2 Shelter and housing, 2.3 Medical services, 2. 4 Education*). A household could then score values of 0-4 on this sub-criterion index (or 0%, 25%, 50%, 75%, 100%). This score can be compared with a distribution average in the comparator population for the same composite index. As with option 1 above, this would constitute a deviation from IRIS, which explicitly states that a pass needs to be achieved at the sub-criterion level; under this option a household may be taken out of the IDP stock despite underperformance on a specific sub-criterion. In order to construct an index in each criterion, at least 2 binary indicators per criterion would be required, but more would be recommended. A small number of indicators per criterion would result in a cruder measure, thereby barely overcoming challenge 2 (as we will still be comparing discrete values – e.g. 0;1;2 in the case of 2 indicators for a given criterion - with a continuous distribution average; so for a given household to perform on par or better than the benchmark, it would be irrelevant whether the benchmark valuer was, say, 0.1 or 0.9 – in either case the household in question would need to score a 1 to achieve a pass on this criterion). Assuming at least 3 indicators per each of the 5 criteria (and 4 indicators in the case of criterion 2, in alignment with its 4 sub-criteria), this would result in an overall computation based on at least 16 indicators.

\begin{table}[!htpb]
\caption{\label{tab:option2}Option 2: A composite metric at the criterion level}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{lXXllX}
\toprule
 & Criterion & Sub-criteria & Indicator & Composite & Comparison to benchmark \\
\midrule
Household A & \multirow{3}{\hsize}{1. Safety and security} & \multirow{2}{\hsize}{1.1 Victims of violence} & Indicator 1.1.a & 2/3 & 1.9 (Pass)\\
& & & Indicator 1.1.b &   &  \\
& & 1.2 Freedom of movement & Indicator 1.2.a & & \\
\midrule
 & \multirow{4}{\hsize}{2. Adequate standard of living}  & 2.1 Food security & Indicator 2.1.a & 3/4 & 3.5 (No pass)\\
 & & 2.2 Shelter and housing & Indicator 2.2.a & & \\
 & & 2.3 Medical services & Indicator 2.3.a & & \\
 & & 2.4 Education & Indicator 2.4.a & & \\
 \midrule
 &  \multirow{3}{\hsize}{3. Access to livelihoods} & \multirow{2}{\hsize}{3.1 Employment and livelihoods} & Indicator 3.1.a & 2/3 & 1.9 (Pass) \\
 & & & Indicator 3.1.b &   &  \\
 & & 3.2 Economic security & Indicator 3.2.a & & \\
 \midrule
 &  \multirow{3}{\hsize}{4. Restoration of housing, land and property} & \multirow{3}{\hsize}{4.1 Property restitution and compensation} & Indicator 4.1.a & 1/3 & 0.9 (Pass)\\
  & & & Indicator 4.1.b &   &  \\
   & & & Indicator 4.1.c &   &  \\
 & \multirow{3}{\hsize}{5. Access to documentation} & \multirow{3}{\hsize}{5.1 Documentation} & Indicator 5.1.a & 0/3 & 0.9 (No pass)\\
   & & & Indicator 5.1.b &   &  \\
   & & & Indicator 5.1.c &   &  \\
 \midrule
& \multicolumn{5}{>{\hsize=\dimexpr4\hsize+6\tabcolsep+3\arrayrulewidth\relax}X}{\textbf{Decision:} The household has not overcome displacement as the composite index for some criteria is lower than the benchmark.}\\
\bottomrule
\end{tabularx}
\end{table}

\newpage 

### Option 3: A set of composite sub-indices at the sub-criterion level

Very similar to the second approach, one could define composite indices within each sub-criterion (see Table \ref{tab:option3}). For example, the composite index for sub-criterion *2.1 Food security* could be associated with 3 equally weighted binary indicators. A household could then score values of 0-3 on this sub-criterion index (or 0%, 33%, 66%, 100%). This score can be compared with a distribution average in the comparator population for the same composite index. The major difference between this option and options 1&2 above is that this option would not constitute a methodological deviation from IRIS, in that it would ensure that a pass is achieved at the sub-criterion level for a household to be taken out of the IDP stock. However, there is a serious feasibility issue with this option. As with the preceding option, at least 2 binary indicators are required per sub-criterion to construct an index, but more would be recommended. A small number of indicators per sub-criterion would result in a cruder measure, thereby barely overcoming challenge 2 (as we will still be comparing discrete values – e.g. 0;1;2 in the case of 2 indicators for a given sub-criterion - with a continuous distribution average; so for a given household to perform on par or better than the benchmark, it would be irrelevant whether the benchmark valuer was, say, 0.1 or 0.9 – in either case the household in question would need to score a 1 to achieve a pass on this criterion). Assuming at least 3 indicators per each of the 10 sub-criteria, this would result in an overall computation based on at least 30 indicators – which appears overly burdensome for widespread application. 

\begin{table}[!htbp]
\caption{\label{tab:option3}Option 3: A composite metric at the sub-criterion level}
\centering
\scalebox{0.55}{
\begin{tabularx}{1.7\textwidth}{lXXllX}
\toprule
 & Sub-criteria & Indicators & & Composite & Comparison to benchmark \\
\midrule
Household A & \multirow{3}{\hsize}{1.1 Victims of violence} & Indicator 1.1.a & 1 & 3 & 2.8 (Pass)\\
& & Indicator 1.1.b & 1 & & \\
& & Indicator 1.1.c & 1 & & \\
\midrule
& \multirow{3}{\hsize}{1.2 Freedom of movement} & Indicator 1.2.a & 1 & 3 & 2.5 (Pass) \\
& & Indicator 1.2.b & 1 & & \\
& & Indicator 1.2.c & 1 & & \\
\midrule
 &  \multirow{3}{\hsize}{2.1 Food security} & Indicator 2.1.a & 1 & 2 & 1.1 (Pass)\\
 & & Indicator 2.1.b & 0 & & \\
& & Indicator 2.1.c & 1 & & \\
\midrule
 & \multirow{3}{\hsize}{2.2 Shelter and housing} & Indicator 2.2.a & 1 & 2 & 1.9 (Pass) \\
  & & Indicator 2.2.b & 0 & & \\
& & Indicator 2.2.c & 1 & & \\
\midrule
 &\multirow{3}{\hsize}{ 2.3 Medical services} & Indicator 2.3.a & 1 & 3 & 3 (Pass)  \\
   & & Indicator 2.3.b & 1 & & \\
& & Indicator 2.3.c & 1 & & \\
 \midrule
  &\multirow{3}{\hsize}{2.4 Education} & Indicator 2.4.a & 1  & 1 & 2.5 (No pass) \\
    & & Indicator 2.4.b & 0 & & \\
& & Indicator 2.4.c & 0 & & \\
 \midrule 
 & \multirow{3}{\hsize}{3.1 Employment and livelihoods} & Indicator 3.1.a & 0 & 0 & 1.5 (No pass) \\
  & & Indicator 3.1.b &  0 & &  \\
 & & Indicator 3.1.c &  0 & &  \\
    \midrule
 & \multirow{3}{\hsize}{3.2 Economic security} & Indicator 3.2.a & 0 & 1 & 2.9 (No pass) \\
  & & Indicator 3.2.b &  0 & &  \\
  & & Indicator 3.2.c &  1 & &  \\
 \midrule
 & \multirow{3}{\hsize}{4.1 Property restitution and compensation} & Indicator 4.1.a & 1 & 3 & 2.5 (Pass)\\
  & & Indicator 4.1.b & 1  & &  \\
   & & Indicator 4.1.c & 1  & & \\
   \midrule
 & \multirow{3}{\hsize}{5.1 Documentation} & Indicator 5.1.a & 0 & 2 & 1.8 (Pass)\\
   & & Indicator 5.1.b &  1 & & \\
   & & Indicator 5.1.c &  1 &  & \\
 \midrule
& \multicolumn{5}{>{\hsize=\dimexpr4\hsize+6\tabcolsep+3\arrayrulewidth\relax}X}{\textbf{Decision:} The household has not overcome displacement as some composite indices on the sub-criterion level are lower than the benchmark.}\\
\bottomrule
\end{tabularx}
}
\end{table}


\newpage

### Option 4: Comparison of homogeneous cells: 

Rather than trying to create a continuous indicator value at the household level through composite indices as in the first three options, an alternative approach could be to divide the IDP population into small homogeneous "cells" – for example by location of displacement, area of habitual residence and year of arrival (see Table \ref{tab:option4}). Even if selecting just one indicator per sub-criterion (i.e. 10 indicators for the measure overall), for each cell an average value could be calculated which subsequently can be compared against the distribution average in the comparator benchmark. The decision whether displacement has ended is no longer made on the individual household level but on the cell level. If an IDP cell has achieved a durable solution in comparison to the benchmark, all IDPs in this group are taken out of the stock of IDPs. If the cell has not achieved a durable solution, all IDPs remain as IDPs in the stock. The advantage of this option is that it is the only one to truly overcome challenge 2 and fully deliver to the contextualized approach proposed by IRIS, in that it would be comparing continuous cell values with benchmark continuous values. The shortcoming of this option is that the aggregate results may depend heavily on the criteria chosen for dividing IDP populations into cells. A strong assumption of homogeneity in the cells is necessary.


\begin{table}[!htp]
\caption{\label{tab:option4}Option 4: Comparison of homogeneous cells}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{XXlXX}
\toprule
 & Sub-criteria & Indicator & Percentages in cell Z & Benchmark comparison \\
\midrule\multirow{10}{\hsize}{Household A is classified into cell Z (e.g. current location, area of origin and year of arrival} & 1.1 Victims of violence & Indicator 1.1.a & 29\% & 28\% (Pass) \\
 & 1.2 Freedom of movement & Indicator 1.2.a & 26\% & 25\% (Pass) \\
 & 2.1 Food security & Indicator 2.1.a & 2.2\% & 2\% (Pass) \\
 & 2.2 Shelter and housing & Indicator 2.2.a & 19\% & 19\% (Pass) \\
 & 2.3 Medical services & Indicator 2.3.a & 3.5\% & 3\% (Pass)\\
 & 2.4 Education & Indicator 2.4.a & 1\% & 3.5\% (No pass)\\
 & 3.1 Employment and livelihoods & Indicator 3.1.a & 12\% & 15\% (No pass)\\
 & 3.2 Economic security & Indicator 3.2.a & 25\% & 29\%  (No pass)\\
 & 4.1 Property restitution and compensation & Indicator 4.1.a & 31\% & 25\% (Pass)\\
 & 5.1 Documentation & Indicator 5.1.a & 35\% & 18\% (Pass)\\
\midrule
& \multicolumn{4}{>{\hsize=\dimexpr4\hsize+6\tabcolsep+3\arrayrulewidth\relax}X}{\textbf{Decision:} All households in cell Z (that includes household A) have not overcome displacement as their average distribution in some sub-criteria is lower than the average in the benchmark.}\\
\bottomrule
\end{tabularx}
\end{table}

\newpage

### Option 5: Classifier/regression-based approach

Another option for the "solutions measure" could be to take a regression-based approach in which the 10 sub-criteria are used as covariates to predict whether a household should still be classified as an IDP household or not (see Table \ref{tab:option5}). A probabilistic classifier, such as a logistic regression, would estimate whether an IDP household is distinct from the host community (i.e. high probability to be an IDP) or whether an IDP household is very similar to households in the host community (i.e. low probability to be an IDP). Important decisions to make before implementing this option are which classifier to select, how to select probability cut-off points to determine whether a specific household is similar to IDPs or to hosts, and how to deal with sample imbalance in the data. While this approach would overcome the challenge of comparing IDP households with host community households, this approach needs further clarifications and is not sensible to underperformance on specific indicators. 

\begin{table}[!htp]
\caption{\label{tab:option5}Option 5: A classifier/regression-based approach}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{XlXXX}
\toprule
 & Sub-criteria & Indicator & & Regression weights \\
\midrule
Household A & 1.1 Victims of violence & Indicator 1.1.a & 1 & -1.58\\
 & 1.2 Freedom of movement & Indicator 1.2.a & 1 & -0.04\\
 & 2.1 Food security & Indicator 2.1.a & 1 & 1.59\\
 & 2.2 Shelter and housing & Indicator 2.2.a & 1 & -2.24\\
 & 2.3 Medical services & Indicator 2.3.a & 1 & 0.48 \\
 & 2.4 Education & Indicator 2.4.a & 0 & 4.48\\
 & 3.1 Employment and livelihoods & Indicator 3.1.a & 0 & 6.72\\
 & 3.2 Economic security & Indicator 3.2.a & 0 & 2.13\\
 & 4.1 Property restitution and compensation & Indicator 4.1.a & 1 & 4.32\\
 & 5.1 Documentation & Indicator 5.1.a & 1 & -0.22\\
\midrule
 & \multicolumn{2}{l}{\rule{0pt}{1em}Predicted probability for household (e.g. logit transformed)} &  & 0.439 \\
  & \multicolumn{2}{l}{\rule{0pt}{1em}Cut-off point} &  & 0.5 \\
 \midrule
 & \multicolumn{4}{>{\hsize=\dimexpr3\hsize+30\tabcolsep+10\arrayrulewidth\relax}X}{\textbf{Decision:} The household has not overcome displacement as the predicted probability of being similar to the host community is below the cut-off point.}\\
\bottomrule
\end{tabularx}
\end{table}

\bigskip
  Box \ref{box:box2} summarizes the main advantages and disadvantages of the different metrics. The note going forward aims to provide empirical information how these metrics perform (that is how many IDPs they count as having overcome their displacement-related vulnerabilities). 


\begin{story}[ht]
  \framedbox{
\begin{minipage}{0.24\textwidth}
Pass/fail measure \\
(No comparison!) \\~\\


1. Composite metrics \\
across all criteria \\~\\

2. Composite metrics at \\
the criterion level \\~\\

3. Composite metrics at \\
the sub-criterion level \\~\\

4. Homogeneous cells \\~\\

5. Classifier/regression-based \\

\end{minipage}%
\hfill
\begin{minipage}{0.7\textwidth}
\begin{tabular}{|p{\textwidth}}
\checkmark Sensitivity to underperformance on the sub-criteria level \\
\textcolor{red}{X} No comparison between IDP and comparator households; potentially restrictive\\~\\

\checkmark Comparability of scores with few indicators needed \\
\textcolor{red}{X} No sensibility to underperformance on specific (sub-criteria) \\~\\

\checkmark Comparability of scores \\
\textcolor{red}{X} No sensibility to underperformance on specific sub-criteria; higher data needs (at least 16 indicators) \\~\\

\checkmark Comparability of scores and sensibility to underperformance on sub-criterion level \\
\textcolor{red}{X} Very high data needs (many indicators needed) \\~\\

\checkmark Full contextualization, comparison of continuous values \\
\textcolor{red}{X} Depends on assumption of homogeneous IDPs within cells, may be highly sensitive to boundaries of cells \\~\\

\checkmark Full contextualization possible \\
\textcolor{red}{X} Depends on regression assumptions; no sensibility to underperformance on specific sub-criteria\\

\end{tabular}
\end{minipage}
}
  \caption[]{Main advantage and disadvantage of different metrics}
  \label{box:box2}
\end{story}


# Methodology

This note follows a purely technical and empirical approach to assess how different indicators and different metrics to combine these indicators perform and result in IDPs overcoming their displacement-related vulnerabilities, thereby exiting the IDP stock in statistical terms. Overall, the assessment follows four steps: The first step was to identify the universe of potential indicators that could be used to measure the 10 sub-criteria. The second step was to identify suitable empirical datasets that contain enough statistical indicators from this theoretical universe to compare their performance against each other. In a third step, the relevant indicators in the datasets were prepared for the analysis by turning all indicators into binary variables and by creating composite indices. Finally, the selected datasets were used to assess the indicators and the different metric options in simulations. This final simulation step means that for each metric option, it was assessed how many IDPs exit the dataset for each possible indicator combination. The simulated results provide information on the performance of indicators and metrics that can inform the process of developing a fully applicable measure for durable solutions. The following sections outline the details of the methodology. 

## Step 1: Identifying the universe of potential indicators

The first methodological step was to map out the universe of potential indicators that could be used to operationalize the 10 sub-criteria on the basis of the Durable Solutions Library.^[The Durable Solutions Library is an inter-agency project led by the Special Rapporteur on the Human Rights of IDPs, coordinated by JIPS, and technically steered by a broad group of partners engaged in durable solutions work.] For each sub-criterion, multiple statistical indicators exist but there is no comprehensive list of all theoretically possible indicators. However, this is important to guide the selection of suitable datasets for this assessment. The universe of potential indicators should be a realistic list of indicators that are often used in surveys while also covering multiple potential operationalizations of the 10 sub-criteria. 

As one of the most comprehensive collection of often-used statistical indicators for durable solutions, the list of indicators contained in the Durable Solutions Library was mapped on to the 10 sub-criteria. To demonstrate, the library specifies the indicator "Target population residing in durable housing structures" which was mapped on to the sub-criterion *2.2 Shelter and housing*. Overall, 52 possible indicators were mapped on to the 10 sub-criteria. While the library only contains one possible indicator for some of the sub-criteria, up to 10 possible operationalizations for *3.2 Economic Security* are covered.^[The DS library also includes indicators on distributions (e.g. Target population who experienced moderate or severe food insecurity in the last year, *by main obstacle to obtaining sufficient food*.). In the case of these indicators it is not clear what constitutes a solution to displacement (Which obstacle to obtaining food is tolerable for IDPs and which one is not?) and how hosts and IDPs can be compared. These disaggregated indicators were dropped from the mapping.]  See Table \ref{tab:indicators} for a break down of the possible indicators per sub-criterion. 

This universe of potential indicators forms a theoretical baseline to identify empirical datasets that cover many of these indicators in practice. It should also be noted that the Durable Solutions Library identifies general indicators defined in broad terms. Empirical datasets can contain a plurality of more concrete, specific and narrower indicators that can be associated with one of the statistical indicators in the Durable Solutions Library.

```{r load_data}
source("simulations.R")
data_nigeria <- targets::tar_read("data_nigeria")
data_hargeisa <- targets::tar_read("data_hargeisa")
data_sudan <- targets::tar_read("data_sudan")
data_colombia <- targets::tar_read("data_colombia_hh")

indicators_nigeria <- extract_indicators(data_nigeria)
indicators_hargeisa <- extract_indicators(data_hargeisa)
indicators_sudan <- extract_indicators(data_sudan)
indicators_colombia <- extract_indicators(data_colombia)

sudan_helper <- sapply(indicators_sudan, length)
colombia_helper <- sapply(indicators_colombia, length)

DS <- data.frame(
  "Subcriteria in IRIS" = c(IASC$Subcriteria,
                            "Number of possible combinations"),
  "Durable Solutions \nLibrary" = c(7,1,1,8,4,3,8,10,6,4, " "),
  "IDP Profiling \nin Hargeisa" = 
    c(sapply(indicators_hargeisa, length),nrow(expand.grid(indicators_hargeisa))),
  "IDP Profiling \nin Nigeria" =
    c(sapply(indicators_nigeria, length),nrow(expand.grid(indicators_nigeria))),
  "IDP Profiling \nin El Fasher" =
    c(sudan_helper[1],0,sudan_helper[2:9], nrow(expand.grid(indicators_sudan))),
   "LSMS \nin Colombia" =
    c(colombia_helper[1],0,colombia_helper[2:7],0, colombia_helper[8], nrow(expand.grid(indicators_colombia)))
)
```


## Step 2: Selecting empirical datasets on IDP vulnerabilities & solutions

In a second step, the aim was to identify and select empirical datasets that cover many potential indicators to measure the 10 sub-criteria defined in the IRIS and that are contained in the mapped-out universe of statistical indicators from the Durable Solutions Library. The first dataset selected for this simulation exercise is the *Internal Displacement Profiling in Hargeisa*^[UNHCR, 2015, “Internal Displacement Profiling in Hargeisa”, https://reliefweb.int/report/somalia/internal-displacement-profiling-hargeisa-december-2015] that was conducted by UNHCR with support of JIPS and the Protection Cluster’s Profiling Task Force in 2015. The second dataset stems from the World Bank *Profile of Internally Displaced Persons in North-East Nigeria*^[World Bank, 2018, “Profile of Internally Displaced Persons in North-East Nigeria 2018”, https://microdata.worldbank.org/index.php/catalog/3410] in 2018. Both datasets cover IDP households displaced by conflict and violence but the dataset in Hargeisa is focused on urban displacement while the Nigerian dataset allows an assessment of in-camp IDPs and IDPs in host communities. The two datasets are complemented with another dataset covering IDPs in camps on the household level: The third dataset comes from the *Durable Solutions Profiling in El Fasher*^[JIPS, 2019, "Progress towards durable solutions in Abu Shouk and El Salam IDP camps", https://www.jips.org/uploads/2019/12/JIPS-Sudan-profilingreport-2019.pdf] which was conducted in 2019 in a cooperation between the Government of Sudan, the IDP communities of Abu Shouk and El Salam, the World Bank, and the UN Country Team. These three datasets were chosen because they cover a wide range of possible indicators for durable solutions and because they cover IDPs and host communities.^[Covering hosts and IDPs is crucial for this methodological assessment to facilitate the task of finding a comparator population.] Finally, the case selection was complemented with the *Living Standards Measurement Study in Colombia 2019* (LSMS)^[DANE, 2019, http://microdatos.dane.gov.co/index.php/catalog/678/study-description]. The LSMS is a useful addition to the case selection as it allows to compare a national representation of displaced households to a national average, as opposed to a comparisons to the host community only. The identifying question whether displacement has occured or not has been asked on the individual-level in this dataset. Hence, we briefly discuss how a household level assessment of the solutions measure performs in comparison to an individual-level assessment. The datasets - summarised in Table \ref{tab:datasets} - were readily available in the Humanitarian Data Exchange, the World Bank Microdata Library, the data library of the Colombian National Statistical Office or were provided by JIPS.^[If survey weights were available (not the case in Hargeisa), they are considered in the simulations to ensure representativeness.]

\begin{table}[!htp]
\caption{\label{tab:datasets}Selection of empirical datasets}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{llllX}
\toprule
Dataset & Year & Assessment level & Benchmark & Displacement context \\
\midrule
Hargeisa (Somaliland) & 2015 & Household & Host community & Urban; conflict, insecurity \& drought \\
North-East Nigeria & 2018 & Household & Host community & In camps \& host communities; conflict \& violence\\
El Fasher (Sudan) & 2019 & Household & Host community & In camps; conflict \& violence\\
Colombia &  2019 & Household \& Individual & National average & National representation; conflict \& violence, some disaster-related\\
\bottomrule
\end{tabularx}
\end{table}


The datasets were then checked to identify whether they contained the relevant 52 indicators from the Durable Solutions Library.  Table \ref{tab:indicators} summarizes how many indicators for each sub-criterion were present in the empirical datasets. As previously mentioned, the datasets can cover multiple more detailed indicators than the mapping from the Durable Solutions Library which lists general indicators. See the appendix for a full table of all indicators in the Durable Solutions library mapped to a sub-criterion and complemented with the indicators available in the empirical datasets.^[When identifying available indicators in the datasets, the aim was to be as inclusive as possible and to use as much information present in the data as possible. However, some indicators had to be dropped because of too many missing values or no variance at all.] 

```{r indicator_present}
knitr::kable(DS, booktabs = T,
             format = "latex",
             linesep = "",
             row.names = F,
             col.names = gsub("[.]", " ", names(DS)),
             caption = "\\label{tab:indicators}Potential and empirically existent indicators for durable solutions")%>%
  kable_styling(latex_options = "hold_position", font_size=9) %>% 
  row_spec(10, hline_after = TRUE)%>%
  add_header_above(c("  " = 1,
                     "Indicators from" = 1, 
                     "Of which, available in ..." = 4))%>%
  column_spec(2, width = "6.8em") %>% 
  column_spec(3:6, width = "5.3em")
```


This identification of indicators is crucial as it builds the baseline for the following simulations. In Hargeisa, `r sum(sapply(indicators_hargeisa,length))` indicators could be identified. For example, the dataset contains `r DS[5,3]` possible indicators for measuring *2.3 Medical services* as the survey asked respondents for access to child vaccinations and basic services, as well as for attendance of births by medical personnel. For the two sub-criteria *1.2 Freedom of movement* and *3.1 Employment and livelihoods*, the data only contained one possible indicator and an indicator choice cannot be evaluated for these two dimensions. As the indicators are not used individually but in a combination of at least 10 (for the 10 sub-criteria), this leads to a total of `r nrow(expand.grid(indicators_hargeisa))` possible indicator combinations that can be assessed in simulations. 

In Nigeria, `r sum(sapply(indicators_nigeria,length))` indicators could be identified. However, since the indicators in Nigeria are more concentrated on two sub-criteria, only `r nrow(expand.grid(indicators_nigeria))` possible combinations for simulations exist. The dimensions *1.2 Freedom of movement, 2.1 Food security, 3.1 Employment and livelihoods*, and *5.1 Documentation* are only covered with one possible indicator. The dataset in Nigeria is particularly rich covering whether IDPs were victims of violence, their shelter and housing conditions as well as their economic security.

In Sudan, the profiling in El Fasher yielded `r sum(sapply(indicators_sudan,length))` indicators that can be combined to `r nrow(expand.grid(indicators_sudan))` possible combinations for simulations. It should be noted that the IDP profiling in El Fasher did not contain a suitable indicator to measure whether IDPs enjoy freedom of movement. For all other sub-criteria, the profiling contains 2 to 4 possible indicators. However, some of these indicators had to be aggregated from the household member surveys that were conducted alongside the household assessments.^[More specifically, to make an assessment whether the household has access to education, employment, and documentation, the variables are aggregated from the household member surveys by assuming that at least one child should go to school, at least one household member should be employed, and at least one household member should have documentation.]

In Colombia, the LSMS contains a total of `r sum(sapply(indicators_colombia,length))` indicators that could be used to measure solutions to displacement. The dataset does not contain any indicators to measure *1.2 Freedom of movement* and *4.1 Property resitution and compensation*. These sub-criteria are hence omitted in the analysis. For *2.1 Food security* and *5.1 Documentation*, the data only contained one indicator, which allows to include the sub-criteria in the analysis but does not allow for an assessment of how the indicator selection may affect the results. However, the data is particularly rich assessing the economic security and the livelihoods of IDPs and the national average.

## Step 3: Preparing the indicators and indices for simulation

After having identified all relevant indicators in the data, the aim is to apply the above outlined metric options to the datasets to identify how many IDPs exit the IDP stock in each of the metrics. Additionally, this should not only be done for one set of 10 indicators but for at least 10000 combinations (if available) in the data. To iterate through at least 10000 indicator combinations for each metric option, the indicators were first prepared for these simulations. Importantly, all indicators were coded as binary indicators that are coded as 1 if a displacement-related vulnerability was overcome and coded as 0 if the vulnerability persists for a specific household. For example, not reporting a security incident is a 1 as this is a positive achievement for durable solutions. For a simple pass/fail measure and the different composite metrics, those binary indicators can be directly combined to the composites at the relevant total, criterion and sub-criterion level.^[Regarding metric option 2 and 3, the composite indices were built by combining three indicators at the (sub-)criterion level (where possible). In the case of having only one or two empirical indicators for a sub-criterion or a criterion and not enough empirical indicators to build an index in the dataset, the single indicator was used for this specific (sub)-criterion while the other (sub-)criteria while more indicators were turned into indices. In a final metric development, it would be necessary to have enough indicators to build a complete composite index with 3 or more elements.] 

Metric option 4 is based on homogeneous IDP population cells that first have to be defined before they can be assessed as a group average. In El Fasher (Sudan), the IDP population was grouped into subgroups based on their type of housing. This was chosen because the El Fasher questionnaire did not contain many other variables to group the IDPs into logical groups. In Colombia, we did not divide the IDP households into different cells. <!-- but only tried different homogeneous cells on the *individual level*.^[On the individual level, the IDPs in Colombia were divided by their gender, age group, marital status, region of displacement, duration of displacement, ethnic minority, and their status as peasants. See details discussed later.] --> In Nigeria and Hargeisa, the IDP population was split into different subgroups based on core demographics, their timing of displacement and their places of displacement and origin.

```{r cell_options}
cells_hargeisa <- combn(names(select(data_hargeisa, starts_with("HH_"))),3) %>% t()
cells_nigeria <- combn(names(select(data_nigeria, starts_with("HH_"))),3) %>% t()
cells_colombia <- combn(names(select(data_colombia, starts_with("HH_"))),3) %>% t()
```

To do so, the assessment did not pick out one variable to group the population but iterated through different ways to split the IDP population to be able to make a judgement to what extent the different groupings affect the overall results (i.e. how many IDPs exit the stock). In Hargeisa, `r nrow(cells_hargeisa)` different groupings were tested based on using three of the grouping variables below. For example, one population split was based on the gender, the clan, and the departure period of a household (e.g. one grouping consists of female-headed households that belong to the Isa clan and were displaced after 2010). In Nigeria, `r nrow(cells_nigeria)`  different groupings were tested based on picking three of the grouping variables below. The following cell variables were used to split the IDP population in Hargeisa and Nigeria into subgroups:
  
  \bigskip
\begin{minipage}{0.47\textwidth}
\footnotesize
\begin{tabular}{p{\textwidth}}
\textbf{\textcolor{DodgerBlue!50!Black}{Hargeisa:}}
\begin{itemize}
\item \textbf{Gender of the household head} (female, male)
\item \textbf{Clan of the household} (Haw, Isa, Rah, Dar, Dir, Gab, Other, Unknown)
\item \textbf{Origin district} (29 origin districts)
\item \textbf{Region of origin} (Displaced from South Central, from Somaliland, from South Central OoS),
\item \textbf{Departure period} (Before 1990, Between 1990 and 200, Between 2000 and 2010, After 2010)
\end{itemize}
\end{tabular}
\end{minipage}
\hfill
\begin{minipage}{0.47\textwidth} %
\footnotesize
\begin{tabular}{|p{\textwidth}}
\textbf{\textcolor{DodgerBlue!50!Black}{Nigeria:}}
\begin{itemize}
\item \textbf{Year of displacement} (ranging from 1998 to 2018)
\item \textbf{Year of arrival} (ranging from 1998 to 2018)
\item \textbf{Region of displacement} (Adamawa, Bauchi, Borno, Gombe, Taraba, Yobe)
\item \textbf{Region of origin} (Different state in Nigeria, Outside Nigeria, Same local government area, Same state, Same ward)
\end{itemize}
\end{tabular}
\end{minipage}
<!--\hfill
\begin{minipage}{0.31\textwidth} %
\footnotesize
\begin{tabular}{|p{\textwidth}}
\textbf{\textcolor{DodgerBlue!50!Black}{Colombia:}}
\begin{itemize}
\item \textbf{Gender} (female, male)
\item \textbf{Age group} (Children, Youth, Adults, Elderly)
\item \textbf{Marital status} (Not married, with partner, married, divorced/separated, single, widowed, missing)
\item \textbf{Region of displacement} (34 admin areas)
\item \textbf{Duration of displacement} (In 5-year steps)
\item \textbf{Ethnic minority} (yes, no)
\item \textbf{Peasant} (yes, no)
\end{itemize}
\end{tabular}
\end{minipage}-->
\bigskip

Finally, a regression-based approach requires a methodological decision how to classify an IDP household as still vulnerable or as able to exit the IDP stock. In this assessment a logistic classifier was fitted to determine whether a household is similar to an IDP household or a host community household. After fitting a regression, we can predict the probability that a specific IDP household is closer to the other IDPs or to the host community but this requires a threshold value (e.g. 0.5) to make the decision. In this demonstration, we have not picked a threshold but optimized this threshold from the data by choosing the threshold that best separates the IDP and host population. If a regression-based approach is used in the future, this cut-off point requires further refinement and a final methodological decision. 

## Step 4: Iteratively simulating the indicator and metric choice 

After identifying the indicators for this assessment in each survey and preparing the indicators for analysis, iterative simulations following the scheme in Figure \ref{fig:sim_approach} were run.  For each dataset, 10 000 possible combinations of 10 indicators (one for each of the sub-criteria) were assessed using all five metric options outlined above. To be able to compare the five possible metric options to a simple pass/fail approach, the simulations also included this option. In each simulation (given a set of indicators and the chosen metric), we report the number of IDPs overcoming their displacement-related vulnerabilities. After all combinations of indicators and metrics were analyzed, it is possible to assess to what extent a single indicator affects the number of IDPs exiting the stock in each metric type by running linear regressions.

![Simulation approach \label{fig:sim_approach}](design/sim_approach.png)

```{r flow_diagram, eval=F}

# DO NOT RUN! Produces html output

grViz("
digraph dot {

graph [layout = dot, rankdir = LR]

node [shape = Rounded,
      style = filled,
      color = grey,
      fontname= Arial]

node [fillcolor = dodgerBlue4]
Dataset

node [fillcolor = dodgerBlue3]
b[label= 'Combination 1\nof 10 indicators'] 

node [fillcolor = gray55]
c[label= 'Combination 2 \nof 10 indicators']  
d[label= 'Combination ... \nof 10 indicators'] 

node [fillcolor =  dodgerBlue]
e[label = 'Pass/fail']
f[label = 'Metrics option 1'] 
g[label = 'Metrics option 2'] 
h[label = 'Metrics option 3'] 
i[label = 'Metrics option 4'] 
j[label = 'Metrics option 5'] 

node [fillcolor =  gray80]
k[label = 'Iterate through the pass/fail \nand the 1-5 metrics options'] 
l[label = 'Iterate through the pass/fail \nand the 1-5 metrics options']  

node [fillcolor =  white, label = 'Report number of IDPs overcoming vulnerabilities']
m n o p q r 

node [fillcolor =  gray95]
s[label = 'Report number of IDPs overcoming vulnerabilities for each metric'] 
t[label = '...'] 

edge [color = grey]
Dataset -> {b c d}
b -> {e f g h i j}
c -> {k}
d -> {l}
e -> {m}
f -> {n}
g -> {o}
h -> {p}
i -> {q}
j -> {r}
k -> {s}
l -> {t}

}")

```

# Country-by-country findings on indicator and metric selection

## Simulation results for Hargeisa (UNHCR 2015)

```{r simulation_results_hargeisa}
DS_mean_hargeisa <- mean(c(DS_Original_hargeisa$DS,
                           DS_Option1_hargeisa$DS,
                           DS_Option2_hargeisa$DS, 
                           DS_Option3_hargeisa$DS, 
                           DS_Option4_hargeisa$DS, 
                           DS_Option5_hargeisa$DS))

DS_perc_mean_hargeisa <- mean(c(DS_Original_hargeisa$DS_perc,
                                DS_Option1_hargeisa$DS_perc,
                                DS_Option2_hargeisa$DS_perc, 
                                DS_Option3_hargeisa$DS_perc, 
                                DS_Option4_hargeisa$DS_perc, 
                                DS_Option5_hargeisa$DS_perc))

combinations_hargeisa  <- data_hargeisa %>% extract_indicators() %>% generate_combinations()
hargeisa_idps <- data_hargeisa %>% filter(ID ==1)
missing_har <- 1:nrow(combinations_hargeisa) %>% 
    map_dbl(~hargeisa_idps%>% select(as.character(combinations_hargeisa[.x,])) %>% negate(complete.cases)() %>% mean()) %>% 
    enframe(name = NULL, value = "missing")

```

The IDP profiling in Hargeisa covered a total of `r sum(data_hargeisa$ID)` IDP households that could be compared directly to their hosts. On average across all simulated indicators and metrics, `r round(DS_mean_hargeisa,2)` IDP households have overcome their vulnerabilities and exit the IDP stock. According to this assessment, an average of  `r round(DS_perc_mean_hargeisa*100,2)`% of the sampled IDP population in Hargeisa could exit the stock for statistical purposes because they have overcome key displacement-related vulnerabilities. However, some IDP households could not be assessed as the IRIS recommends that no assessment should take place if data is missing on at least one of the 10 sub-criteria. Depending on the different indicator combination, an average of `r round(mean(missing_har$missing)*100,2)`% of IDP households could not be assessed due to missing data on at least one of the key indicators. In those instances, the IDP household remains in the stock. This demonstrates that a lot of the variation in the number of IDPs exiting the stock does not come from the selection of indicators but rather the missingness for some of those possible operationalizations of the 10 sub-criteria. 

### Importance of indicator selection

The first question this assessment aims to address is how much difference there is between using different operationalizations of the 10 sub-criteria. To address the question of selecting statistical indicators, Table \ref{tab:HAR} summarizes the relevance of the indicator choice in Hargeisa. The table lists all indicators that are present in the data and provides information on the average effect of choosing one indicator over the other across all metrics. 

\bigskip
```{r ind_hargeisa_table}

dict_hargeisa <- readxl::read_excel("Data/dict.xlsx", sheet = "hargeisa")

run_OLS <- function(data){
  lm(DS_perc*100 ~ .,
     data %>% 
       select(., starts_with("I"), -any_of("iteration"), 
              -where(~all(.==first(.))),DS_perc)) %>% 
    broom::tidy(.,conf.int = TRUE)
}

indicator_OLS_hargeisa <- bind_rows(
 # run_OLS(DS_Original_hargeisa),
  run_OLS(DS_Option1_hargeisa),
  run_OLS(DS_Option2_hargeisa),
  run_OLS(DS_Option3_hargeisa),
  run_OLS(DS_Option4_hargeisa),
  run_OLS(DS_Option5_hargeisa)
) %>%
  group_by(term) %>%
  summarize(across(c(estimate, conf.low, conf.high), mean)) %>%
  filter(term != "(Intercept)") %>%
  mutate(term = str_replace(term, "^(I\\d+)", "")) %>%
  left_join(dict_hargeisa, by = c(term = "variable")) %>%
  mutate(term1 = str_c(indicator, label, sep = ": ") %>% fct_rev(),
         subcriterion = substr(term1,1,3))

temp_har <- indicator_OLS_hargeisa%>%
  group_by(subcriterion) %>%
  summarise(text=paste(label,collapse=', \n'),
            estimate_h = round(max(estimate,na.rm=T),2),
            estimate_l = round(min(estimate,na.rm=T),2)) %>% 
  mutate(effect_size = paste(estimate_l,"to",estimate_h, "percentage points", sep= " "))

temp_har$text <- paste(c("Experience of security incident (baseline),",
        "More meals than average (baseline),",
        "Bathroom access (baseline),",
        "Access to medical service if needed (baseline),",
        "Child ever attended school (baseline),",
        "Durable assets (baseline),",
        "Recompensation mechanisms accessible (baseline),",
        "Possession of birth certificate (baseline),"), temp_har$text)


HAR <- data.frame(
  "Subcriteria (IRIS)" = IASC$Subcriteria,
  "Indicators in Hargeisa (UNHCR 2015)" = c(temp_har$text[1],"Only available indicator was whether IDPs are free to visit public places.",
                                            temp_har$text[2:5],"Only available indicator was whether IDP household has a breadwinner or not.",
                                            temp_har$text[6:8]),
  "Average effect size on stock" = c(temp_har$effect_size[1],"No other indicator",
                                            temp_har$effect_size[2:5],"No other indicator",
                                            temp_har$effect_size[6:8]),
  "Description of variation" = c(
    "Hardly any discernable difference between different indicators",
    " ",
     "Hardly any discernable difference between different indicators",
     "Hardly any discernable difference between different indicators",
     "Some difference between different indicators",
     "Hardly any discernable difference between different indicators",
     " ",
    "Some difference between different indicators",
     "Notable difference between different indicators for HLP rights",
     "Some difference between different indicators"
  ))


knitr::kable(HAR,"latex", booktabs = TRUE,
              linesep = "",
             row.names = F,
             col.names = gsub("[.]", " ", names(HAR)),
             caption= "\\label{tab:HAR}Average relevance of indicator choice across metrics (Hargeisa)") %>%
  kable_styling(latex_options = "hold_position", font_size=10)%>%
  column_spec(1, width = "10em") %>% 
  column_spec(2, width = "14em") %>% 
  column_spec(3, width = "9em") %>% 
  column_spec(4, width = "10em") %>% 
  row_spec(1:9, hline_after = TRUE)

```

For example, choosing an indicator that covers the ability to pay for food as opposed to an indicator that counts whether an IDP household had more meals than the average IDP household decreases the percentage of IDPs exiting the stock by an average of `r round(indicator_OLS_hargeisa$estimate[indicator_OLS_hargeisa$term == "I3_pay_food"],2)` percentage points across all metrics in this simulation. Expressed differently, the ability to pay for one’s own food is a slightly higher bar to pass than consuming above-average meals, which means that less IDPs will overcome their vulnerabilities. The last column of the table gives a verbal summary of the average effect of indicator selections across all metrics. 

It should be noted that for most of the 10 sub-criteria, the exact indicator choice does not matter strongly across the different metric option. There is no discernible difference in the indicators for *1.1. Victims of violence*, *2.1. Food security*, *2.2 Shelter and housing*, and *2.4. Education* as the percentage point change is on average smaller than 1. For the sub-criteria *2.3. Medical services*, as an example, there is some differences between using access to medical services, birth attendance by skilled health personnel and child vaccinations with access to medical services being the most restrictive indicator. However, in substantive terms, the difference between these indicators increases or decreases the exit from the IDP stock by only around `r temp_har$effect_size[4]`. 

Most importantly, there is a strong and notable difference between the different indicators for *4.1 Property restitution and compensation*. It is observable that having access to documentation for housing, land and property (HLP) or having HLP access restored is more permissive, allowing more IDPs to exit the stock than the presence of compensation mechanisms. Compensation mechanisms seem to be hardly present for IDPs in the Hargeisa case, leading to a decrease in IDP exits from the stock by `r temp_har$effect_size[7]`, if such an indicator is chosen. 

To visualize the results of this indicator assessment, Figure \ref{fig:indicator_hargeisa} displays the average effect of choosing one indicator over the other averaged across all assessed metric options. The shown effect sizes must be understood in comparison to the baseline indicator (see baselines in Table \ref{tab:HAR}). The effect plot displays clearly that HLP indicators for access to property or documentation for property are crucial indicators that drive a lot of variation in the simulations compared to other indicators for sub-criteria. This means, that if a decision is made on which indicator to choose for measuring *4.1 Property restitution and compensation*, the selection of other indicators is changing the amount of IDPs exiting the stock significantly less.

```{r indicator_plots_hargeisa, fig.cap="\\label{fig:indicator_hargeisa}Average effect of indicator selection across metrics on IDPs exiting the stock (Hargeisa)", out.width="75%"}

ggplot(indicator_OLS_hargeisa %>% filter(is.na(label)==F),
       aes(x=term1, y=estimate)) +
  geom_hline(yintercept=0, colour="#8C2318", size=1) +  # Line at 0
  geom_pointrange(aes(ymin=conf.low, ymax=conf.high), 
                  position = position_dodge(1)) +
  labs(x="Indicator", 
       y="Average effect estimate across metrices (in % of IDP stock)") +  
  coord_flip() +  # Rotate the plot
  theme_bw()+
  theme(legend.position = "bottom")
```

Overall, even if there are some differences in the operationalization of the 10 sub-criteria, and the indicator selection tends to matter more, the simulations in the context of Hargeisa suggests that the average effect of choosing one indicator over the other is often neglectable in practice. In this indicator assessment, the most relevant choice is clearly related to HLP rights.

### Importance of metric selection

The simulation approach is also intended to answer a second question that is to what extent the different metric options produce varying estimates of the exit from the IDP stock. Table \ref{tab:HAR_metric} summarizes the key findings related to the range of IDP households that exit the stock across all metrics (how much variation there is in results), and how important the choice of individual indicators is in each approach. The table also provides the mean number of IDP households exiting the stock. It can be generally said that the choice which indicators are used matters in some metrics more than in others as some metrics are more volatile than others. 

\bigskip
```{r Har_metric}
options <- c("Pass/fail measure (no comparison!)","1: Full composite",
             "2: Composite at criterion level", "3: Composite at sub-criterion level",
             "4: Comparison of homogeneous cells","5: Classifier/ regression-based")

data_str <- c("DS_Original_hargeisa",paste0("DS_Option",1:5, "_hargeisa"))


columns <- c(" ","Mean of IDPs exiting the stock",
             "Range of IDPs exiting the stock",
             "Variation in how many IDPs exit the stock")
 
HAR_metric <- data.frame(
  Var1 = options,
  mean = sapply(data_str, function(x){round(mean(get(x)$DS),2)}),
  mean_p = sapply(data_str, function(x){round(mean(get(x)$DS_perc*100),2)}),
  range =  sapply(data_str, function(x){paste(range(get(x)$DS),collapse = " to ")}),
  range_p = sapply(data_str, function(x){paste(round(range(get(x)$DS_perc*100),2),collapse = " to ")}),
  var = sapply(data_str, function(x){round(sd(get(x)$DS),2)})
) %>% 
  mutate(range = paste0(range, " IDPs (" , range_p, "% of stock)"),
         mean = paste0(mean, " IDPs (",mean_p,"% of stock)"),
         var = paste(c("Low (SD:", "High (SD:","Middle (SD:",
                       "No variation (SD:","Very low (SD:", "Very high (SD:"),
                     var,")")) %>% 
  select(-range_p, -mean_p) %>% t()

# get row and colnames in order
rownames(HAR_metric) <- columns
colnames(HAR_metric) <- HAR_metric[1,]

knitr::kable(HAR_metric[-1,], "latex",
             booktabs = TRUE, linesep = "",
             caption= "\\label{tab:HAR_metric}Simulation results for Hargeisa across all metrics (Total sample of IDPs: 4780 households)") %>%
  kable_styling(latex_options = "hold_position", font_size=10)%>%
  column_spec(1, width = "5em") %>% 
  column_spec(2:3, width = "5.7em") %>% 
  column_spec(4:7, width = "6.2em")
```

When using one composite metric across all criteria (all 10 indicators for each sub-criterion are summarized into one index) and when using a regression-based approach, the choice of indicators matters the most and the metric yields high variation. In the case of one composite metric, measuring the sub-criterion *4.1. Property restitution and compensation* by assessing the documentation and restoration of property rather than the access to compensation mechanisms increases the percentage of IDPs overcoming their vulnerabilities by around `r round(max(run_OLS(DS_Option1_hargeisa)$estimate),2)` percentage points. In the case of a regression-based assessment whether an IDP household is more likely to be similar to other IDPs vs. the host communities, the same indicator can even increase the percentage of IDPs overcoming their vulnerabilities by `r round(max(run_OLS(DS_Option5_hargeisa)$estimate),2)` percentage points. Albeit less strongly, the choice which indicators are used is also more severe in the case of a composite metric at the criterion level (as up to `r round(max(run_OLS(DS_Option2_hargeisa)$estimate),2)` percentage point difference can be between different indicators). For options 1, 2 and 5, it is hence important to note that these metric options create varying estimates of exits from the stock and are very sensitive to the indicator selection. 

For other metric options, the importance of choosing the right indicator is very diminished as the metrics produce very similar estimates of the exit from IDP stocks across all indicators. As multiple indicators are combined at the sub-criterion level, option 3 indicates that none of the IDPs exit the stock. The option performs very similar to a pass/fail scenario in which no comparison with the host community takes place. Finally, when IDPs are divided into subgroups and then compared with the host population, the simulation also revealed that very few IDP subgroups exit the IDP stock. In the simulations, `r nrow(cells_hargeisa)` different groupings for IDPs were tried based on the region of origin, the clan, gender, and departure period of IDPs in Hargeisa. However, none of the groupings yielded strongly different results compared to other groupings. See the additional Box \ref{box:box_hargeisacells} for more details on the effect of different ways of grouping the IDP stock on the performance of the homogeneous cells approach. 

Figure \ref{fig:density_hargeisa} displays the density of the conducted simulations for the 5 identified metric options. To allow comparisons, a simple pass/fail measure on the sub-criterion level has been added but readers should note that this does not enable any comparisons with hosts. The graph displays on the x-axis what percentage of the IDP population in the dataset has overcome vulnerabilities and exits the stock. The y-axis displays the density of simulations or how many of the simulations shared the same outcome (number of IDPs exiting the stock). Note that the y-axis and the x-axis in the different graphs have their own scaling to make visualization easier. 

```{r density_plots_hargeisa, fig.cap="\\label{fig:density_hargeisa}Density of simulations for all possible metrics (Hargeisa)", out.width= "85%"}
plot_density <- function(data,title){
  ggplot(data)+
    geom_density(aes(x = DS_perc), fill="dodgerblue",alpha = 0.5)+
    geom_vline(aes(xintercept = mean(DS_perc)), 
               linetype = "dashed")+
    scale_x_continuous(labels = scales::label_percent(), limits = c(-0.001,0.9)) +
    labs(x = "Simulated proportion overcoming vulnerabilities", 
         y = "Simulation density",
         title = title)+
    theme_bw()+
    theme(title = element_text(size=8), text = element_text(size= 8),
          axis.title = element_text(size=8))
}

plot_density_no_variation <- function(data,title){
  ggplot(data)+
    geom_density(aes(x = DS_perc), fill="dodgerblue",alpha = 0.5)+
    geom_vline(aes(xintercept = mean(DS_perc)), 
               linetype = "dashed")+
    scale_x_continuous(labels = scales::label_percent()) +
    labs(x = "Simulated proportion overcoming vulnerabilities", 
         y = "Simulation density",
         title = title)+
    theme_bw()+
    theme(title = element_text(size=8), text = element_text(size= 8),
          axis.title = element_text(size=8))
}

(plot_density(DS_Original_hargeisa, "Pass/fail measure") + 
    plot_density(DS_Option1_hargeisa,"1: Full composite"))/
  (plot_density(DS_Option2_hargeisa,"2: Composite at criterion level") + 
     plot_density_no_variation(DS_Option3_hargeisa, "3: Composite at sub-criterion level"))/  
  (plot_density(DS_Option4_hargeisa, "4: Comparison of homogeneous cells") + 
     plot_density(DS_Option5_hargeisa, "5: Classifier/regression-based"))
```

The first observation from these density plots is that the pass/fail measure, the composite measure at criterion level, the composite measure at sub-criterion level, and the comparison of cells all yield similar results: most of the simulations based on these metric options result in 0 IDPs overcoming their vulnerabilities and exiting the stock. Simulations based on a composite measures at the criterion level has a clear peak around 0 percentage of IDPs - that means that most simulations show that no IDPs exit the stock - while the average simulation suggests that `r round(mean(DS_Option2_hargeisa$DS))` IDP households overcome their vulnerabilities (`r round(mean(DS_Option2_hargeisa$DS_perc)*100,2)`% of the stock). For a composite measure at the sub-criterion level, there is no variation and all simulations indicate that no IDP exits the stock. This means that both composite metric options are not strongly dependent on the selected indicators. It also indicates that the metrics are relatively restrictive and classify few IDPs as having overcome their key vulnerabilities. Because of their high threshold to exit IDPs from the stock, they behave like a pass/fail measure that does not compare IDPs with a comparator population. Similarly, the cell-based metric option showed low volatility to the selection of indicators and the selection of grouping variables in the case of Hargeisa.

Making a regression-based assessment whether a specific household is predicted to be an IDP household or a host community household is an option that has the highest variability, which means that depending on the indicator combination chosen, the resulting number of IDPs exiting the stock can be considerably higher or lower. Keeping all other indicators constant, using an indicator whether IDPs have restored their access to property can classify around `r round(max((lm(DS ~ .,DS_Option5_hargeisa %>% select(., starts_with("I"), -any_of("iteration"), -where(~all(.==first(.))),DS)) %>% broom::tidy(.,conf.int = TRUE))$estimate))` more IDP households as exiting the stock as opposed to measuring this sub-criterion as access to restoration mechanisms. The simulations reveal a bimodal distribution: many simulations cluster around 0-5% of the IDP population overcoming their vulnerabilities. At the same time, many simulations center around 55% of IDPs overcoming their vulnerabilities. From this distribution, it is hence difficult to assess what the true percentage of IDPs having achieved a solution in statistical terms might be. The split into bimodal distribution is strongly linked to the selection of the HLP indicators that separate the IDP population strictly into those that do not have HLP rights realised and those without. If a restrictive HLP indicator is chosen the simulations peak around 0, if a more lenient indicator is chosen, the average simulations move closer to 50%. 

Constructing one composite measure across all criterion (option 1) is a metric option that has the second highest variability. Keeping all other indicators constant, using an indicator whether IDPs have documentation to prove their property rights can classify around `r round(max((lm(DS ~ .,DS_Option1_hargeisa %>% select(., starts_with("I"), -any_of("iteration"), -where(~all(.==first(.))),DS)) %>% broom::tidy(.,conf.int = TRUE))$estimate))` more IDP households as exiting the stock as opposed to measuring this sub-criterion as access to restoration mechanisms. The conclusion is that if data is combined into one index across all criteria and if a regression-based approach is used, it is strongly advisable to carefully determine a final set of indicators to measure solutions to ensure that data across displacement contexts is comparable. 

### Identification of solutions on household level

We also investigated if the different simulations always identify *the same* IDP households as candidates to exit the stock or if the different metric options pick up different vulnerable groups. To do this, we calculate the Cohen's kappa coefficient. Cohen's kappa is a statistic that is normally used to measure "inter-rater reliability" or the idea that if a coder A identifies an IDP household as household that overcomes all vulnerabilities, an independent coder B should also identify this IDP household as no longer vulnerable, In the case of these simulations, the "coder" is essentially the different metric options we have available. For example, to be a robust measure, the homogeneous cell approach should pick up more or less the same few households as vulnerable as the composite measures at the criterion level.  

Figure \ref{fig:kappa-har} displays the results of the Cohen's kappa coefficient for the different metric options. The interpretation works as follows: Brighter blue suggests that the two metrics options on the x and y axis pick up the same households as vulnerable. Darker blue suggest that Cohen's kappa is low and they hardly pick up the same households as vulnerable. Overall, because many metrics are very identify few exits from the stock, Cohen's kappa is rather low. However, we can for example see that grouping IDPs into cells based on the gender, origin district and broader region yields similar results to groupings based on gender, origin district and clan or gender, origin district and departure year. In contrast, groupings based on broader region, gender and departure year do not compare well to other groupings.


```{r ira_hargeisa, fig.cap="\\label{fig:kappa-har}Inter-rater agreement between different metric options for Hargeisa. Note that metric option 3 is excluded as no variation in IDP exits is achieved.", out.width="85%"}
metric_pairs_har <- read_csv("kappa/hargeisa.csv") %>% 
  filter(x!= "4b: Algorithmic clustering") %>% 
  filter(y!= "4b: Algorithmic clustering")  %>% 
  mutate(rows = row_number()) %>% 
  ggplot() + 
  geom_tile(aes(reorder(x,rows), reorder(y,-rows), fill = kappa), color = "grey50") + 
  scale_y_discrete(label = function(x) {str_replace(x, " \\(", "\n\\(")}) +
  scale_x_discrete(label = function(x) {str_replace(x, " \\(", "\n\\(")},
                   guide = guide_axis(angle = 90),
                   position = "top") + 
  scale_fill_steps() +
  labs(x = " ", y = " ")+
  theme_minimal() +
  theme(legend.position = "bottom", text = element_text(size = 8))

metric_pairs_har
```

\newpage
### Overall feasibility and application of metric options

Some metric options turned out to be easier to implement than others in the dataset on IDPs in Hargeisa. In terms of feasibility, the metric option 1, which showed high sensitivity to indicator selection, was easy to implement as the construction of one index is straightforward. However, a problem with this metric option is not only its variability but also that elements of the index may be collinear. 

  Regarding the metric options 2 + 3, that both require multiple indices on the criterion and the sub-criterion level, the feasibility of this approach is much lower. First, they require more indicators than the other metrics to be able to construct additive indices. For example, in Hargeisa there were simply not more than one indicator available to measure *1.2 Freedom of movement* and *3.1 Employment and livelihood*. It is expected that producers of official statistics may also have challenges to generate the data necessary for these more data hungry indices. Second, the theoretical conceptualization is not fully advanced yet. An “ideal” composite index is always made of theoretically distinct elements (i.e. we measure different dimensions of displacement-related vulnerabilities). However, when multiple indicators that measure very much the same theoretical concept are combined to one index at the sub-criterion level (e.g. similar indicators that all measure whether IDPs’ shelter and housing conditions are satisfactory), the different indicators are likely very much correlated. An example is that individual living in an overcrowded space very often also live in a makeshift space. This multicollinearity of elements of an index raises questions whether strongly correlated elements of an index should be weighted differently than other elements. The problem of developing a theoretically sound index also exists when an index is built on the criterion level. So far, the IRIS already identifies four distinct sub-criteria for the adequate standard of living of IDPs. However, it is not clear if we can theoretically identify more than one dimension to empirically measure the criterion *5. Documentation*. These questions of theoretical conceptualization, correlation between elements in the index, and the high data demands reduce the feasibility to implement the metric options 2 and 3 in practice. 

Dividing the IDP population in Hargeisa into sub-groups to assess homogeneous cells that can then be compared to the host community is relatively easy to implement for National Statistical Offices. However, it goes beyond the scope of this methodological note to assess precisely how the boundaries between cells (i.e. the criteria to divide the IDP populations) affect the results. In Hargeisa, the available variables to build cells did not indicate high volatility to the grouping. However, a final selection of this metric option would need to assess 1) which delimitations should be used, 2) if the number of variables to divide the IDP population matters, 3) if the size of the cells matters, and if the 4) homogeneity or heterogeneity in a cell matter. While this option is initially easy to implement, it raises many new methodological challenges.

Finally, using a regression-based approach has some disadvantages and advantages. First, further methodological work is needed to identify an easy-to-implement but also successful classifier that predicts whether an IDP household is more similar to other IDPs or to the host community. A logistic regression or linear regression seems plausible here. Furthermore, it has to be decided what the probability cut-off is, or at what predicted probability an IDP household should be no longer considered displaced. Another practical problem in this approach is that comparisons across contexts might be difficult. While a regression in one country might assign a lot of weight to indicators for the freedom of movement, in another country it might be much more important whether food security has been achieved. From the point of a national statistical system, it might be difficult to identify why the regression coefficients vary across contexts and sub-criteria and how different assessments can be compared between displacement situations. 

\begin{story}[htbp!]
  \framedbox{
  \footnotesize
\textbf{How should the IDP population be split into homogeneous cells?} 
\bigskip

To fully assess the suitability of the homogeneous cell approach, we have to assess different ways in which the IDP population can be grouped in cells. Theoretically, the expectation is that some ways of grouping the overall population will lead to larger groups; other groupings could lead to smaller groups. The group size, the homogeneity within IDP cells and the heterogeneity across IDP cells could affect how many IDP households exit the stock. 

\bigskip
\textbf{Grouping variables in the data to split the IDP population:} First, we selected three grouping variables from the data - for example the gender of the household head, the clan of the household and their origin district - and then grouped the IDPs into subgroups based on these grouping variables and calculated averages to compare to the host community average. In the simulations, we can do this iteratively for multiple possible grouping variables. In total, in Hargeisa, we tried 10 different groupings (see table). The key findings are summarised here:

\begin{itemize}
\item The grouping leading to the fewest exits from the IDP stock was based on region of origin, gender and departure period with no IDPs exiting the stock.
\item The grouping leading to the most exits from the IDP stocks was based on the origin district, the clan, and the departure period with over 10 IDPs exiting the stock on average across indicator combinations. 
\item The overall impression is that more fine-grained groupings (e.g. by clan, by departure period, and by district) can potentially lead to more exits from the stock as some small groups might outperform the host population.
\item In contrast, broader and more coarse groupings (e.g. by gender or region of origin) are more restrictive as broader IDP groups do not outperform the host population. 
\item In total, the groupings did not affect the results strongly. 
\end{itemize}


\bigskip
\textbf{Algorithmic clustering:} Second, we employed automatic hierarchical clustering algorithms to group the IDPs into groups based on their performance on the different indicators. That means, an algorithm identifies IDP households in the data that are similar to each other in the sense that they perform equally well on certain sub-criteria while equally bad on others. These automatic groupings yield IDP cells that are most homogeneous within the cells and most heterogeneous in comparison to other cells. This is a data-driven approach that can provide some key lessons for finding good grouping variables. The hierarchical clustering revealed a data-driven cell approach could potentially increase the exit from the IDP stock as similarities between IDP households are exploited and the "best-performing" households are grouped together and taken out of the stock. While there are easily applicable software packages for hierarchical clustering, further exploration is needed if National Statistical Offices can implement such approaches. 

\scalebox{0.95}{
\begin{tabular}[t]{lll>{\raggedleft\arraybackslash}p{6.7em}>{\raggedleft\arraybackslash}p{6.7em}>{\raggedright\arraybackslash}p{8em}}
\toprule
Group variable 1 & Group variable 2 & Group variable 3 & Average number of IDPs exiting the stock & Average percentage of IDPs exciting the stock & Range and mean of group size\\
\midrule
Region of origin & Clan & Departure period & 0.59 & 0.01 & 1 to 1042  (\textasciitilde{} 65 )\\
Region of origin & Gender & Clan & 2.76 & 0.06 & 1 to 1338  (\textasciitilde{} 111 )\\
Region of origin & Gender & Departure period & 0.00 & 0.00 & 1 to 774  (\textasciitilde{} 184 )\\
Region of origin & Gender & Origin district & 4.82 & 0.10 & 1 to 1715  (\textasciitilde{} 34 )\\
Region of origin & Origin district & Clan & 4.88 & 0.10 & 1 to 953  (\textasciitilde{} 46 )\\
Region of origin & Origin district & Departure period & 4.55 & 0.10 & 1 to 1288  (\textasciitilde{} 65 )\\
Gender & Clan & Departure period & 0.50 & 0.01 & 1 to 922  (\textasciitilde{} 26 )\\
Gender & Origin district & Clan & 5.94 & 0.12 & 1 to 513  (\textasciitilde{} 31 )\\
Gender & Origin district & Departure period & 8.09 & 0.17 & 1 to 673  (\textasciitilde{} 67 )\\
Origin district & Clan & Departure period & 10.32 & 0.22 & 1 to 811  (\textasciitilde{} 21 )\\
\midrule
Algorithmic clustering &  & & `r round(mean(DS_Option4b_hargeisa$DS),2)` & `r round(mean(DS_Option4b_hargeisa$DS_perc)*100,2)` &  \\
\bottomrule
\end{tabular}
} 
  }
  \caption[]{Identifying IDP subgroups to implement the homogeneous  cell approach (Hargeisa)}
  \label{box:box_hargeisacells}
\end{story}


```{r cells_hargeisa, eval = F}

# Do not run as already printed above

count_groupsize <- function(data, cells, x){
  group_size = data %>% filter(ID == 1) %>% 
    group_by(across(as.character(cells[x,]))) %>% 
    summarise(group_size = sum(WT,na.rm=T))
  
  paste(
  paste(c(round(min(group_size$group_size)),round(max(group_size$group_size))),collapse = " to "),
  " (~", round(mean(group_size$group_size)),")")
}


hargeisa_groups <- sapply(1:10, function(x){count_groupsize(x,data=data_hargeisa %>% mutate(WT = 1),cells=cells_hargeisa)})

DS_Option4_hargeisa %>% 
  group_by(cell_1,cell_2,cell_3) %>% 
  summarise('Average number of IDPs exiting the stock' = round(mean(DS),2),
            'Average percentage of IDPs exciting the stock' = round(mean(DS_perc)*100,2)) %>% ungroup %>% 
  mutate(cell_1 = factor(cell_1,labels = c("Region of origin","Gender","Origin district")),
         cell_2 = factor(cell_2,labels = c("Clan","Gender","Origin district")),
         cell_3 = factor(cell_3,labels = c("Clan","Departure period","Origin district")))%>% 
  rename('Group variable 1'=cell_1,'Group variable 2'=cell_2,'Group variable 3'=cell_3) %>% 
  cbind(., data.frame("Range and mean of group size" = hargeisa_groups)) %>% 
  kable(., "latex", booktabs =T,linesep = "", caption = "Effect of different grouping variables on overall exit from the IDP stock in Hargeisa") %>%
  kable_styling(latex_options = "hold_position", font_size=9) %>% 
  column_spec(4:5, width = "6.7em")%>% 
  column_spec(6, width = "8em")

```

\newpage

## Simulation results for Nigeria (World Bank 2018)

```{r simulation_results_nigeria}
DS_mean_nigeria <- mean(c(DS_Original_nigeria$DS,
                           DS_Option1_nigeria$DS,
                           DS_Option2_nigeria$DS, 
                           DS_Option3_nigeria$DS, 
                           DS_Option4_nigeria$DS, 
                           DS_Option5_nigeria$DS))

DS_perc_mean_nigeria <- mean(c(DS_Original_nigeria$DS_perc,
                                DS_Option1_nigeria$DS_perc,
                                DS_Option2_nigeria$DS_perc, 
                                DS_Option3_nigeria$DS_perc, 
                                DS_Option4_nigeria$DS_perc, 
                                DS_Option5_nigeria$DS_perc))

combinations_nigeria  <- data_nigeria %>% extract_indicators() %>% generate_combinations()
nigeria_idps <- data_nigeria %>% filter(ID ==1)
missing_nig <- 1:nrow(combinations_nigeria) %>% 
    map_dbl(~nigeria_idps%>% select(as.character(combinations_nigeria[.x,])) %>% negate(complete.cases)() %>% mean()) %>% 
    enframe(name = NULL, value = "missing")


```

The IDP profiling in Nigeria covered a total of `r sum(data_nigeria$ID)` IDP households. Because the dataset includes survey weights, these IDPs represent an overall amount of over `r round(sum(nigeria_idps$WT)/1000,2)` thousand IDP households. On average across all simulated indicators and metrics, `r round(DS_mean_nigeria,2)`  IDP households exit the IDP stock, which corresponds to an average of `r round(DS_perc_mean_nigeria*100,2)`% of the IDPs represented by the profiling. For  an average of `r round(mean(missing_nig$missing)*100,2)`% of the IDP households represented by the profiling in Nigeria, IDP households could not be assessed due to missing data on at least one dimension. Similar to the assessment in Hargeisa, the question remains if it is acceptable that around a seventh of the IDPs remain in the stock because of missing data. 

### Importance of indicator selection

Table \ref{tab:NIG} summarizes how much the choice of one indicator over others can affect the exit from the IDP stock on average across all simulations and all metric options. In the dataset from Nigeria, it is only possible to assess the relevance of the indicator selection for six sub-criteria of the total of 10 sub-criteria. For the remaining four sub-criteria, the data only contains one possible indicator. The table is quickly summarized by concluding that only the indicator choice in *4.1. Property restitution and compensation* matters strongly. For the majority of the other indicator choices, the difference between indicators only increases or decreases the IDP stock by less or around 1 percentage points.  

```{r ind_nigeria_table, out.width="98%"}

dict_nigeria <- readxl::read_excel("Data/dict.xlsx", sheet = "nigeria")

indicator_OLS_nigeria <- bind_rows(
#  run_OLS(DS_Original_nigeria),
  run_OLS(DS_Option1_nigeria),
  run_OLS(DS_Option2_nigeria),
  run_OLS(DS_Option3_nigeria),
  run_OLS(DS_Option4_nigeria),
  run_OLS(DS_Option5_nigeria)
) %>%
  group_by(term) %>%
  summarize(across(c(estimate, conf.low, conf.high), mean)) %>%
  filter(term != "(Intercept)") %>%
  mutate(term = str_replace(term, "^(I\\d+)", "")) %>%
  left_join(dict_nigeria, by = c(term = "variable")) %>%
  mutate(term1 = str_c(indicator, label, sep = ": ") %>% fct_rev(),
         subcriterion = substr(term1,1,3))

temp_nig <- indicator_OLS_nigeria%>%
  group_by(subcriterion) %>%
  summarise(text=paste(label,collapse=', \n'),
            estimate_h = round(max(estimate,na.rm=T),2),
            estimate_l = round(min(estimate,na.rm=T),2)) %>% 
  mutate(effect_size = paste(estimate_l,"to",estimate_h, "percentage points", sep= " "))

temp_nig$text <- paste(c("Feeling of safety at day (baseline),",
                         "Non-durable living arrangement (baseline),",
                         "Access to medical services as needed (baseline),",
                         "Duration to next education facility (baseline),",
                         "Having a bank account (baseline),",
                         "Access to recompensating mechanism for lost HLP (baseline),"), temp_nig$text)


NIG <- data.frame(
  "Subcriteria (IRIS)" = IASC$Subcriteria,
  "Indicators in Nigeria World Bank 2018" = 
    c(temp_nig$text[1],"Only available indicator was whether IDPs feel free to move","Only available indicator was whether IDPs score higher than average on Food Security Scale.",
      temp_nig$text[2:4],"Only available indicator was income generation.",temp_nig$text[5:6],
      "Only available indicator was if IDPs had documents/access to replace missing documents if lost."),
  "Average effect size on stock" = 
    c(temp_nig$effect_size[1],"No other indicator","No other indicator",
      temp_nig$effect_size[2:4],"No other indicator",
      temp_nig$effect_size[5:6], "No other indicator"),
  "Description of variation" = c(
    "Hardly any discernable difference between different indicators",
    " ",
     " ",
         "Some difference between different indicators",
     "Hardly any discernable difference between different indicators",
     "Hardly any discernable difference between different indicators",
     " ",
    "Some difference between different indicators",
     "Notable difference between different indicators for HLP rights",
     " "
  ))

knitr::kable(NIG,"latex", booktabs = TRUE,
              linesep = "",
             row.names = F,
             col.names = gsub("[.]", " ", names(NIG)),
             caption= "\\label{tab:NIG}Average relevance of indicator choice across metrics (Nigeria)") %>%
  kable_styling(latex_options = "hold_position", font_size=10)%>%
  column_spec(1, width = "8.5em") %>% 
  column_spec(2, width = "17em") %>% 
  column_spec(3, width = "9em") %>% 
  column_spec(4, width = "9em") %>% 
  row_spec(1:9, hline_after = TRUE)

```

However, for *4.1 Property restitution and compensation*,  choosing an indicator that measures legally owning the dwelling in comparison to having access to recommendation mechanisms for lost HLP is a more permissive indicator, allowing more IDPs to exit the stock by `r substr(temp_nig$effect_size[6], start=1,stop=4)` percentage points. Compensation mechanisms seem to be hardly present for IDPs in Nigeria, and checking legal ownership of the house in the pre-flight location is a more feasible indicator. 

To visualize the results, Figure \ref{fig:indicator_nigeria} displays the average effect of choosing one indicator over the other averaged across all assessed metric options. Again, the difference between the effect size of the HLP indicators in comparison to the other indicators is striking. While the indicator selection does not matter strongly for the sub-criteria 1-8 and 10, *4.1 Property restitution and compensation* requires a careful assessment to determine how to best measure this for the purpose of the "solutions measure".

```{r indicator_plots_nigeria, fig.cap="\\label{fig:indicator_nigeria}Average effect of indicator selection across metrics on IDPs exiting the stock (Nigeria)", out.width="70%"}

ggplot(indicator_OLS_nigeria %>% filter(is.na(label)==F),
       aes(x=term1, y=estimate)) +
  geom_hline(yintercept=0, colour="#8C2318", size=1) +  # Line at 0
  geom_pointrange(aes(ymin=conf.low, ymax=conf.high), 
                  position = position_dodge(1)) +
  labs(x="Indicator", 
       y="Average effect estimate across metrices (in % of IDP stock)") +  
  coord_flip() +  # Rotate the plot
  theme_bw()+
  theme(legend.position = "bottom")
```

### Importance of metric selection

While the indicator selection matters most for HLP indicators in Nigeria, the different metric options also produce varying estimates for the exit from the IDP stock. As already seen in the data from Hargeisa, using a regression-based approach or one composite metric across all criteria are the most sensitive to the exact indicators used while other approaches show little variation. 

In the case of a full composite metric the selection of an indicator can in some instances make up to `r round(max(run_OLS(DS_Option1_nigeria)$estimate),2)` percentage point difference in the outcome of a simulation. That means that over `r round(max((lm(DS ~ .,DS_Option1_nigeria %>% select(., starts_with("I"), -any_of("iteration"), -where(~all(.==first(.))),DS)) %>% broom::tidy(.,conf.int = TRUE))$estimate))/1000` thousand IDP households may be classified as having overcome their vulnerabilities when one indicator to measure *4.1. Property restitution and compensation* is used while those households do not exit the IDP stock when another indicator is used. In the case of the regression-based classification of IDPs, using an indicator whether a household is the legally recognized owner of their property can on average, when all other indicators stay the same, increase the number of IDPs achieving a durable solution by  `r round(max(run_OLS(DS_Option5_nigeria)$estimate),2)` percentage points compared to an indicator capturing the access to compensation mechanisms. 

However, for all other metric options presented in this note, the choice of indicators seems to be of very minor relevance for the Nigerian case as less than 1 percentage point difference is made by selection one indicator over the other. Table \ref{tab:NIG_metric} summarizes the key findings related to variation across indicators and metrics. Most importantly, we find no variation in the number of IDPs exiting the stock for composite measure at the sub-criterion level and very little variation for homogeneous cells.

\bigskip
```{r Nig_metric}
data_str_n <- c("DS_Original_nigeria",paste0("DS_Option",1:5, "_nigeria"))
 
NIG_metric <- data.frame(
  Var1 = options,
  mean = sapply(data_str_n, function(x){round(mean(get(x)$DS),2)}),
  mean_p = sapply(data_str_n, function(x){round(mean(get(x)$DS_perc*100),2)}),
  range =  sapply(data_str_n, function(x){paste(round(range(get(x)$DS)),collapse = " to ")}),
  range_p = sapply(data_str_n, function(x){paste(round(range(get(x)$DS_perc*100),2),collapse = " to ")}),
  var = sapply(data_str_n, function(x){round(sd(get(x)$DS),2)})
) %>% 
  mutate(range = paste0(range, " IDPs (" , range_p, "% of stock)"),
         mean = paste0(mean, " IDPs (",mean_p,"% of stock)"),
         var = paste(c("Low (SD:", "Very high (SD:","Low (SD:",
                       "No variation (SD:","Very low variation (SD:", "Very high (SD:"),
                     var,")")) %>% 
  select(-range_p, -mean_p) %>% t()

# get row and colnames in order
rownames(NIG_metric) <- columns
colnames(NIG_metric) <- NIG_metric[1,]

knitr::kable(NIG_metric[-1,], "latex",
             booktabs = TRUE, linesep = "",
             caption= "\\label{tab:NIG_metric}Simulation results for Nigeria across all metrics (Weighted IDP households: 129.41 thousand)") %>%
  kable_styling(latex_options = "hold_position", font_size=10)%>%
  column_spec(1, width = "5.2em") %>% 
  column_spec(2:3, width = "5.7em") %>% 
  column_spec(4:7, width = "6.1em")
```

The simulations also show that the groupings of the IDP population into different homogeneous cells to then make a group-level assessment  yields little volatility regarding the variables used for the IDP subgroups. It should be noted that the grouping in Nigeria was based on date of arrival, date of displacement and the origin and displacement location of IDPs as the dataset contained few other variables useful for classification of IDPs into sub-groups. It is realistic that other groupings could be more sensitive and could produce more variation in the number of subgroups exiting the stock of IDPs. A more detailed discussion of different delimitations for IDPs in cells can be found in Box \ref{box:box_nigeriacells}.


\begin{story}[htbp!]
  \framedbox{
  \footnotesize
\textbf{Splitting the Nigerian IDPs into homogeneous cell} 
\bigskip

In Nigeria, the simulations iterated through 4 possible groupings based on arrival or displacement year, and region of origin or displacement. Most of these groupings result in very few or no IDPs exiting the stock. This may be a result of too small or too big cells of IDPs. Overall, the groupings based purely on displacement timing and location of IDPs is not optimal. Further work is needed to define better grouping variables. Usind core demographics (such as gender of household head, etc.) seems more promising.  Using hierarchical clustering, we find can confirm that the homogeneous cell approach in Nigeria yields few exits from the overall IDP stock. 

\bigskip

\scalebox{0.9}{
\begin{tabular}[t]{>{\raggedright\arraybackslash}p{9em}>{\raggedright\arraybackslash}p{8em}>{\raggedright\arraybackslash}p{8em}>{\raggedleft\arraybackslash}p{6.7em}>{\raggedleft\arraybackslash}p{6.7em}>{\raggedright\arraybackslash}p{9.6em}}
\toprule
Group variable 1 & Group variable 2 & Group variable 3 & Average number of IDPs exiting the stock & Average percentage of IDPs exciting the stock & Range and mean of group size\\
\midrule
Year of arrival & Region of origin & Region of displacement & 0 & 0.00 & 3 to 46270  (\textasciitilde{} 1221 )\\
Year of displacement & Year of arrival & Region of origin & 0 & 0.00 & 12 to 45057  (\textasciitilde{} 1294 )\\
Year of displacement & Year of arrival & Region of displacement & 0 & 0.00 & 3 to 49797  (\textasciitilde{} 1407 )\\
Year of displacement & Region of origin & Region of displacement & 14 & 0.01 & 3 to 43390  (\textasciitilde{} 1362 )\\
\midrule
Algorithmic clustering &  & & `r round(mean(DS_Option4b_nigeria$DS),2)` & `r round(mean(DS_Option4b_nigeria$DS_perc)*100,2)` &  \\
\bottomrule
\end{tabular}
}
  }
  \caption[]{Identifying IDP subgroups to implement the homogeneous  cell approach (Nigeria)}
  \label{box:box_nigeriacells}
\end{story}


```{r cells_nigeria, eval = F}

# Do not run as already printed above
nigeria_groups <- sapply(1:4, function(x){count_groupsize(x,data=data_nigeria,cells=cells_nigeria)})

DS_Option4_nigeria %>% 
  group_by(cell_1,cell_2,cell_3) %>% 
  summarise('Average number of IDPs exiting the stock' = round(mean(DS),2),
            'Average percentage of IDPs exciting the stock' = round(mean(DS_perc)*100,2)) %>% ungroup %>% 
  mutate(cell_1 = factor(cell_1,labels = c("Year of arrival","Year of displacement")),
         cell_2 = factor(cell_2,labels = c("Year of arrival","Region of origin")),
         cell_3 = factor(cell_3,labels = c("Region of origin","Region of displacement")))%>% 
  rename('Group variable 1'=cell_1,'Group variable 2'=cell_2,'Group variable 3'=cell_3) %>% 
  cbind(., data.frame("Range and mean of group size" = nigeria_groups)) %>% 
  kable(., "latex", booktabs =T,linesep = "", caption = "Effect of different grouping variables on overall exit from the IDP stock in Hargeisa") %>%
  kable_styling(latex_options = "hold_position", font_size=9) %>% 
  column_spec(1:3, width = "8em")%>% 
  column_spec(4:5, width = "7em")%>% 
  column_spec(6, width = "7em")

```

\newpage

Figure \ref{fig:density_nigeria} displays the simulation density for the 5 different metric options that could be used to implement the IRIS solutions measure in practice. The five options are compared to a simple pass/fail measure which does not implement a comparison to host communities. As a reminder, the graphs show which outcome (i.e. number of IDPs exciting the stock) is particularly common in the simulations across indicator combinations. The same pattern as in Hargeisa can be detected in Nigeria. The composite measure at the criterion level, the composite measure at the sub-criterion level and a comparison of homogeneous cells yield an average number of IDPs exiting the stock close to 0. In fact, the metric option 3 results in 0 IDPs overcoming their key displacement-related vulnerabilities across all indicator simulations. These three metric options essentially generate similar results to a simple pass/fail measure without comparisons to hosts. In the case of the full composite measure (option 1), the density plots show higher variability and up to `r round(mean(DS_Option1_nigeria$DS_perc)*100,2)` percent of the IDP population assessed in Nigeria may have overcome their displacement-related vulnerabilities according to this measure. For a regression-based approach, the assessment again yielded a bimodal distribution. The full composite measure and the regression-based approach are characterized by a much higher variability and the indicator selection is more sensitive in this context.

```{r density_plots_nigeria, fig.cap="\\label{fig:density_nigeria}Density of simulations for all possible metrics (Nigeria)", out.width= "80%"}

(plot_density(DS_Original_nigeria, "Pass/fail measure") + 
    plot_density(DS_Option1_nigeria,"1: Full composite"))/
  (plot_density(DS_Option2_nigeria,"2: Composite at criterion level") + 
     plot_density_no_variation(DS_Option3_nigeria, "3: Composite at sub-criterion level"))/  
  (plot_density_no_variation(DS_Option4_nigeria, "4: Comparison of homogeneous cells") + 
     plot_density(DS_Option5_nigeria, "5: Classifier/regression-based"))
```


### Identification of solutions on household level


Figure \ref{fig:kappa-nig} displays the results of the Cohen's kappa coefficient for the different metric options. Brighter colours suggest that the two metric options on the x and y axis pick up the same households as able to exit the IDP stock. The assessment in Nigeria shows that the composite measure at the criterion level identifies mostly the same IDPs as exiting the stock as a pass/fail measure without comparison to hosts. There is also big overlap between the full composite index (option 1) and a regression-based approach or a composite measure at the criterion level. 

```{r ira_nigeria, fig.cap="\\label{fig:kappa-nig}Inter-rater agreement between different metric options for Nigeria. Metric option 3 is excluded as no IDPs were classified as exiting the stock. A gray color suggests that kappa is undefined because the two metric options evaluated only output that no IDP exits the stock under either metric.", out.width="86%"}

metric_pairs_nig <- read_csv("kappa/nigeria.csv") %>% 
  filter(x!= "4b: Algorithmic clustering") %>% 
  filter(y!= "4b: Algorithmic clustering")  %>% 
  mutate(rows = row_number()) %>% 
  ggplot() + 
  geom_tile(aes(reorder(x,rows), reorder(y,-rows), fill = kappa), color = "grey50") + 
  scale_y_discrete(label = function(x) {str_replace(x, " \\(", "\n\\(")}) +
  scale_x_discrete(label = function(x) {str_replace(x, " \\(", "\n\\(")},
                   guide = guide_axis(angle = 90),
                   position = "top") + 
  scale_fill_steps() +
  labs(x = " ", y = " ")+
  theme_minimal() +
  theme(legend.position = "bottom", text = element_text(size = 8))

metric_pairs_nig
```


### Overall feasibility and application of metric options

Regarding the feasibility of implementing the different metric options in practice and with the capacities of a National Statistical Office in mind, it can be said that the patterns are similar to Hargeisa: The composite measure across all indicators is the easiest to implement. Dividing the IDP population into cells that can then be compared is also fairly easy to implement but may require clearer guidance on the criteria to distinguish different IDP sub-groups. Similarly, a regression-based approach is feasible to implement but requires clarification on probability cut-off, classifier used, and comparisons across contexts. Implementing indices on the criterion or sub-criterion level was more difficult to implement. This problem was even more severe in the dataset used in Nigeria compared to the data in Hargeisa because the dataset did not contain enough possible indicators to form indices for 6 out of 10 sub-criteria. Future assessments of how the IRIS solutions measure can be implemented should use datasets that provide a solid number of different indicators. 

## Simulation results for El Fasher (Sudan 2019)


```{r simulation_results_sudan}
combinations_sudan <- data_sudan %>% extract_indicators() %>% generate_combinations()
sudan_idps <- data_sudan%>% filter(ID ==1)
missing_sud <- 1:nrow(combinations_sudan) %>% 
    map_dbl(~sudan_idps%>% select(as.character(combinations_sudan[.x,])) %>% negate(complete.cases)() %>% mean()) %>% 
    enframe(name = NULL, value = "missing")


```

The IDP profiling in El Fasher (Sudan) covered a total of `r sum(data_sudan$ID, na.rm=T)` IDP households. As with the data from Nigeria, the results presented here are weighted by the survey weights included in the El Fasher sampling. Absolute and relative numbers should hence be compared to the number of `r round(sum(sudan_idps$WT)/1000,2)` thousand IDP households. 

When running the different metric options, the simulations all resulted in 0 IDP households exiting the stock as they compare worse than the host community on the 10 sub-criteria. This finding occurred across all metric options and across all indicators. This is because on average across the different possible indicators, `r round(mean(missing_sud$missing)*100,2)` of the data cannot be assessed due to missingness on one of the 10 dimensions. Three of the indicators that miss the most in the data from Sudan is information on the ownership and documentation of property in the habitual residence and on access to compensation mechanisms. The HLP indicators are missing for many IDP households. If they are present and an assessment can be made, the HLP indicators are very restrictive: most IDP households do not have access to compensation or a written documentation to prove ownership. This explains why 0 IDP households exit the stock across all metrics. In the following sections, the results of the simulations are presented when excluding the HLP dimension (sub-criterion 4.1) in a briefer summary.^[A later section in this note compares more systematically how the sub-criterion  *4.1 Property restitution and compensation* affects the results for Hargeisa and Nigeria.]

First, it should be noted that the effect of indicator selection on the overall result is much more diminished when excluding the indicators for restitution and compensation. The biggest change between one indicator and the other indicator can be observed on the dimension of economic security: when using a measurement for whether the household is above or below the poverty 3.2 USD poverty line the exit from the IDP stock increases by 3.87 percentage points as compared to an indicator that measures the access to a mobile bank account. 

Second, the importance of the indicator selection differs across metrics options and the overall pattern is the same as in Nigeria and Hargeisa: A composite measure at the criterion or sub-criterion level is very restrictive, allowing few IDP households to exit the stock. Similarly, a comparison of homogeneous cells is restrictive and classifies few IDPs as accessing the stock. In Hargeisa, IDPs were grouped into cells based on the housing structure they live in. This resulted in some larger groups, such as 12575 IDP households that live in a Tukul and only around 8 households that live in a house constructed of woods. Across those cells, very few IDP households could exit the stock. However, with other groupings - for which no suitable indicators were available in the dataset - this result could look differently. 

We again find that the full composite index and a regression-based approach are more lenient, identifying more exits from the IDP stock - but they are also more prone to variation depending on the indicators selected and may classify too many IDPs as no longer subjected to displacement-related vulnerabilities when in fact they are. See Figure \ref{fig:density_sudan} for the density plots of the resulting simulations. 

```{r  density_plots_sudan, fig.cap="\\label{fig:density_sudan}Density of simulations for all possible metrics (Sudan)", out.width= "85%"}

(plot_density(DS_Original_nohlp_sudan, "Pass/fail measure") + 
    plot_density( DS_Option1_nohlp_sudan,"1: Full composite"))/
  (plot_density( DS_Option2_nohlp_sudan,"2: Composite at criterion level") + 
     plot_density( DS_Option3_nohlp_sudan, "3: Composite at sub-criterion level"))/  
  (plot_density( DS_Option4_nohlp_sudan, "4: Comparison of homogeneous cells") + 
     plot_density( DS_Option5_nohlp_sudan, "5: Classifier/regression-based"))
```

A final word on the feasibility of the different metric options in El Fasher (Sudan): To fully implement a composite measure at the criterion or sub-criterion level, there are not enough possible indicators on the household level. To implement the solutions simulation, the data from individual household members regarding their educational status, employment and documentation had to be first aggregated, making the process not impossible but more complicated. The IRIS suggests that the solutions measure should be assessed at the household level. If a survey only includes information on the individual level for key individuals, the guidelines developed by EGRIS for implementing the final solutions measure should give a clear indication how this aggregation from the individual to the household should occur: For example, should a binary household-level indicator for employment take the value 1 if one member of the household is employed or if all adult members of the household are employed? The dataset also did not include suitable grouping variables to assess the homogeneous cells approach in different ways. The full composite measure and the regression-based assessment were hence the easiest to implement but they are conceptually more difficult to allow comparisons across displacement contexts and they make the task of selecting the right indicators more acute. 

## Simulation results for Colombia (DANE 2019)

```{r simulation_results_colombia}
DS_mean_colombia <- mean(c(DS_Original_colombia_hh$DS,
                           DS_Option1_colombia_hh$DS,
                           DS_Option2_colombia_hh$DS, 
                           DS_Option3_colombia_hh$DS, 
                           DS_Option4_colombia_hh$DS, 
                           DS_Option5_colombia_hh$DS))

DS_perc_mean_colombia <- mean(c(DS_Original_colombia_hh$DS_perc,
                                DS_Option1_colombia_hh$DS_perc,
                                DS_Option2_colombia_hh$DS_perc, 
                                DS_Option3_colombia_hh$DS_perc, 
                                DS_Option4_colombia_hh$DS_perc, 
                                DS_Option5_colombia_hh$DS_perc))

combinations_colombia  <- data_colombia %>% extract_indicators() %>% generate_combinations()
colombia_idps <- data_colombia %>% filter(ID ==1)
missing_col <- 1:nrow(combinations_colombia) %>% 
    map_dbl(~colombia_idps%>% select(as.character(combinations_colombia[.x,])) %>% negate(complete.cases)() %>% mean()) %>% 
    enframe(name = NULL, value = "missing")


```

The LSMS in Colombia covered a total of `r sum(data_colombia$ID, na.rm=T)` households that have fled from violence or natural disaster (weighted number of households: `r round(sum(colombia_idps$WT)/1000,2)` thousand IDP households). Recognizing the survey weights included in the survey, around `r round(DS_perc_mean_colombia*100,2)`% of the IDPs in Colombia exit the stock on average across all indicators and metrics. On average, `r round(mean(missing_col$missing)*100,2)`% of the IDPs cannot be assessed due to missing data on at least one dimension. This number is so high because 4 variables are often not applicable/missing: attendance of a recognized educational institution, contractual terms of employment and working contract as well as presence of a written lease. For the remaining variables, data is almost complete. This high missingness is likely to also stem from the fact that some indicators have to be aggregated from individual-level survey questions to the household level. 


### Importance of indicator selection

In the Colombian case, it was only possible to assess the importance of selecting the right indicators for six dimensions. For two sub-criteria, no indicators were available at all (*1.2 Freedom of movement*,*4.1 Property restitution and compensation*). For two additional sub-criteria, there was only one indicator available (*2.1 Food security*,*5.1 Documentation*). Table \ref{tab:COL} summarizes how much the choice of one indicator over others can affect the exit from the IDP stock on average across all simulations and all metric options in Colombia for the six possible dimensions that could be assessed. 

```{r ind_colombia_table, out.width="98%"}

dict_colombia <- readxl::read_excel("Data/dict.xlsx", sheet =  "colombia_hh")

indicator_OLS_col <- bind_rows(
  run_OLS(DS_Option1_colombia_hh),
  run_OLS(DS_Option2_colombia_hh),
  run_OLS(DS_Option3_colombia_hh),
  run_OLS(DS_Option4_colombia_hh),
  run_OLS(DS_Option5_colombia_hh)
) %>%
  group_by(term) %>%
  summarize(across(c(estimate, conf.low, conf.high), mean)) %>%
  filter(term != "(Intercept)") %>%
  mutate(term = str_replace(term, "^(I\\d+)", "")) %>%
  left_join(dict_colombia, by = c(term = "variable")) %>%
  mutate(term1 = str_c(indicator, label, sep = ": ") %>% fct_rev(),
         subcriterion = substr(term1,1,3))

temp_col <- indicator_OLS_col%>%
  group_by(subcriterion) %>%
  summarise(text=paste(label,collapse=', \n'),
            estimate_h = round(max(estimate,na.rm=T),2),
            estimate_l = round(min(estimate,na.rm=T),2)) %>% 
  mutate(effect_size = paste(estimate_l,"to",estimate_h, "percentage points", sep= " "))

temp_col$text <- paste(c("Experience of a natural disaster (baseline),",
                         "Legal occupation of dwelling (baseline),",
                         "Possession of health insurance (baseline),",
                         "Literacy (baseline),",
                         "Employment contract duration (baseline),",
                         "Defaulting on utility bills (baseline)"), temp_col$text)


COL <- data.frame(
  "Subcriteria (IRIS)" = IASC$Subcriteria,
  "Indicators in Colombia DANE 2019" = 
    c(temp_col$text[1],"No indicator available","Only available indicator was whether IDPs have an income per capita greater than the food security line",
      temp_col$text[2:6],"No indicator available",
      "Only available indicator was if IDPs had identification documents"),
  "Average effect size on stock" = 
    c(temp_col$effect_size[1],"No other indicator","No other indicator",
      temp_col$effect_size[2:6],"No other indicator", "No other indicator"),
  "Description of variation" = c(
    "Some difference between different indicators",
    " ",
     " ",
         "Hardly any discernable difference between different indicators",
     "Some difference between different indicators",
     "Notable difference between different indicators",
     "Notable difference between different indicators",
    "Notable difference between different indicators",
     " ",
     " "
  ))

knitr::kable(COL,"latex", booktabs = TRUE,
              linesep = "",
             row.names = F,
             col.names = gsub("[.]", " ", names(NIG)),
             caption= "\\label{tab:COL}Average relevance of indicator choice across metrics (Colombia)") %>%
  kable_styling(latex_options = "hold_position", font_size=10)%>%
  column_spec(1, width = "8.5em") %>% 
  column_spec(2, width = "17em") %>% 
  column_spec(3, width = "9em") %>% 
  column_spec(4, width = "9em") %>% 
  row_spec(1:9, hline_after = TRUE)

```

Overall, the selection of indicators creates less differences in the exit from the IDP stock for *2.2 Shelter and housing*, *1.1 Victims of violence* and *2.3 Medical services*. For the remaining 3 sub-criteria, the indicator selection matters much more as choosing one indicator over the other can increase or decrease the exit from the stock by easily over 5 percentage points. However, it should be kept in mind that many assessments are not possible due to missing data. In fact, the reason why we find notable differences across indicators is entirely driven by missing data: For *2.4 Education*, it seems as if measuring this dimension with the question whether respondents attend an officially recognized educational insitution decreases the exit from the stock by `r substr(temp_col[4,"effect_size"],1,6)` percentage points. However, in reality, missingness for this indicator is by almost 80% and this explains why so many IDPs no longer exit the IDP stock. This effect of data missingness also explains the notable differences that can be found between the indicators for *3.1 Employment and livelihoods* and *3.2 Economic security*. 

```{r indicator_plots_col, fig.cap="\\label{fig:indicator_col}Average effect of indicator selection across metrics on IDPs exiting the stock (Colombia)", out.width="75%"}

ggplot(indicator_OLS_col %>% filter(is.na(label)== F),
       aes(x=term1, y=estimate)) +
  geom_hline(yintercept=0, colour="#8C2318", size=1) +  # Line at 0
  geom_pointrange(aes(ymin=conf.low, ymax=conf.high), 
                  position = position_dodge(1)) +
  labs(x="Indicator", 
       y="Average effect estimate across metrices (in % of IDP stock)") +  
  coord_flip() +  # Rotate the plot
  theme_bw()+
  theme(legend.position = "bottom")
```

\newpage

The lesson learnt from this is that indicators should cover the whole population and should minimise missingness to be able to make a reliable assessment. Figure \ref{fig:indicator_col} summarises the effect of the indicator selection again but readers should keep in mind that these differences are strongly determined by data availability. Comparing an indicator that covers the whole IDP households to an indicator that is missing in almost all of the IDP households will automatically result in a high difference between the two indicators. In practice, as the solutions measure is further developed by EGRIS, attention should be paid to selecting indicators that usually result in a high response rate and few missing data points. 

### Importance of metric selection

The importance of selecting the right metric to combine the different indicators is summarised in Table \ref{tab:COL_metric} and the density plots in Figure \ref{fig:density_col}^[Note that in Colombia, the homogeneous cell approach was not fully implemented: IDP households were all together assessed in comparison to the national average and not sub-divided into cells.]. Overall, the variation and standard deviation in how many IDPs exit the stock is higher in the case of Colombia but follows a similar pattern as in the other three cases: 

The most permissive metric options are again a full composite index and a regression-based approach. Both approaches are the most sensitive to the chosen indicators and produce a higher estimate of IDPs exiting the stock on average across simulations. However, in the case of Colombia, we find that the composite measure at the criterion level generates the second-highest exit from the IDP stock with around `r round(mean(DS_Option2_colombia_hh$DS_perc)*100,2)` % of IDPs leaving the stock on average. This result is largely an artefact of the fact that few different indicators are available for each sub-criterion. As a result, the composite indices on the criterion-level are made of very few components and essentially behave like a composite index across all 10 criteria (similar to option 1). 

\bigskip
```{r Col_metric}
data_str_c <- c("DS_Original_colombia_hh",paste0("DS_Option",1:5, "_colombia_hh"))
 
COL_metric <- data.frame(
  Var1 = options,
  mean = sapply(data_str_c, function(x){round(mean(get(x)$DS))}),
  mean_p = sapply(data_str_c, function(x){round(mean(get(x)$DS_perc*100),2)}),
  range =  sapply(data_str_c, function(x){paste(round(range(get(x)$DS)),collapse = " to ")}),
  range_p = sapply(data_str_c, function(x){paste(round(range(get(x)$DS_perc*100),2),collapse = " to ")}),
  var = sapply(data_str_c, function(x){round(sd(get(x)$DS),2)})
) %>% 
  mutate(range = paste0(range, " IDPs (" , range_p, "% of stock)"),
         mean = paste0(mean, " IDPs (",mean_p,"% of stock)"),
         var = paste(c("Middle (SD:", "Very high (SD:","Very high (SD:",
                       "Low (SD:","Middle (SD:", "Very high (SD:"),
                     var,")")) %>% 
  select(-range_p, -mean_p) %>% t()

# get row and colnames in order
rownames(COL_metric) <- columns
colnames(COL_metric) <- NIG_metric[1,]

knitr::kable(COL_metric[-1,], "latex",
             booktabs = TRUE, linesep = "",
             caption= "\\label{tab:COL_metric}Simulation results for Colombia across metrics (Weighted IDP households: 7454.25 thousand)") %>%
  kable_styling(latex_options = "hold_position", font_size=10)%>%
  column_spec(1, width = "5.2em") %>% 
  column_spec(2:3, width = "5.7em") %>% 
  column_spec(4:7, width = "6.1em")
```


The density plots also reflect this pattern and demonstrate that in the case of Colombia, a pass/fail measure, a composite at sub-criterion level and a comparison of cells lead to similar and restrictive results. In contrast, there is more variation and a higher estimate of IDPs leaving the stock in the case of a full composite index, an index on the criterion level and a regression-based approach. 

```{r  density_plots_col, fig.cap="\\label{fig:density_col}Density of simulations for all possible metrics (Colombia)", out.width= "85%"}

(plot_density(DS_Original_colombia_hh, "Pass/fail measure") + 
    plot_density( DS_Option1_colombia_hh,"1: Full composite"))/
  (plot_density( DS_Option2_colombia_hh,"2: Composite at criterion level") + 
     plot_density( DS_Option3_colombia_hh, "3: Composite at sub-criterion level"))/  
  (plot_density( DS_Option4_colombia_hh, "4: Comparison of homogeneous cells") + 
     plot_density( DS_Option5_colombia_hh, "5: Classifier/regression-based"))
```


### Identification of solutions on household level

Plotting the inter-rater agreement between the different metric options in Colombia in Figure \ref{fig:kappa-col} shows that on the household level the full composite measure behaves very similar to the composite measure at the criterion level (bright blue color). Again, this is likely due to the fact that the components of the criterion-level index are very few. 

```{r ira_col, fig.cap="\\label{fig:kappa-col}Inter-rater agreement between different metric options for Colombia. Metric option 3 is excluded as no IDPs were classified as exiting the stock.", out.width="80%"}

metric_pairs_col<- read_csv("kappa/colombia_hh.csv") %>% 
  filter(x!= "4b: Algorithmic clustering") %>% 
  filter(y!= "4b: Algorithmic clustering")  %>% 
  mutate(rows = row_number()) %>% 
  ggplot() + 
  geom_tile(aes(reorder(x,rows), reorder(y,-rows), fill = kappa), color = "grey50") + 
  scale_y_discrete(label = function(x) {str_replace(x, " \\(", "\n\\(")}) +
  scale_x_discrete(label = function(x) {str_replace(x, " \\(", "\n\\(")},
                   guide = guide_axis(angle = 90),
                   position = "top") + 
  scale_fill_steps() +
  labs(x = " ", y = " ")+
  theme_minimal() +
  theme(legend.position = "bottom", text = element_text(size = 8))

metric_pairs_col
```


### Overall feasibility and application of metric options

The results in Colombia demonstrate that the solutions measure and the different proposed metric options can also be applied to a nationally representative sample that includes IDPs. This demonstration is important as the IRIS solutions measure can either compare IDP households to host communities or to national averages.  Nationally representative datasets have the clear advantage to cover the IDP population more thoroughly and not just in specific regions. The solution measure aims to determine the exit from the IDP stock for the purpose of official and aggregated statistics; the here presented results show promisingly that with a careful inclusion of all sub-criteria of the solutions measure in nationally representative datasets, one could easily conduct a solutions assessment without separate IDP profiling surveys. This increases the incentives for EGRIS to use commonly used indicators, such as the Sustainable Development Goals indicators, in the final selection of indicators for the solutions measure to increase the chances that those indicators are already included in broader surveys to generate official statistics.

Compared to targeted IDP profilings, as used in the other country examples, a large-scale nation-wide survey has fewer indicators available to conduct the simulations. Hence, the results of the Colombian case are difficult to interpret. As there are fewer indicators available, the composite indices on the criterion and sub-criterion level contain not enough elements. Furthermore, two of the 10 sub-criteria had to be ignored to be able to run the simulations. This indicates that some of the metric options, in particular option 2 and 3, might have too high data demands and require too many additional questions than can be expected to add to existing survey rounds by National Statistical Offices. A composite measure across all sub-criteria, a homogeneous cells approach, or a regression-based approach seems more plausible in this context. 

Another lesson learnt from this is that any nationally representative survey that wants to implement the IRIS solutions measure should carefully included at least one indicator for each sub-criterion in the household questionnaire. This is particularly important for questions around HLP rights in the place of habitual residence and questions around the freedom to move that are *not* commonly covered in large-scale national surveys. If those topics could be included more prominently in surveys, implementing the solutions measure could become more feasible.

Finally, it should be added that we ran the simulations on the household and the individual level. Some of the indicators are more easily measured on the individual level (like education and employment). Others are most appropriate to measure on the household level. The IRIS prescribes that an assessment should take place on the household level and we present the main results on this level. However, it should be noted briefly that if an individual-level assessment is made, a smaller share of IDPs exits the stock. Fewer individuals tick of all the boxes. Aggregating the results at the household level may masks some inequalities in access to solutions within the household. While it might be acceptable that a household exits the stock if one person has access to employment, this might not be the case for other indicators: For example, access to identification documentation should be universal for all members of a displaced household. A definition of the final set of indicators should hence consider carefully how indicators on the individual level translate into household-level indicators. 


# Findings on the selection of metric options

The assessment shows that the different available options to implement the contextualized approach that IRIS promotes and to find a workable measure have different strengths and weaknesses. Table \ref{tab:summary} summarizes these insights.



\begin{table}[!htp]
\caption{\label{tab:summary}Summary of metric advantages and disadvantages}
\scriptsize
\begin{tabularx}{\textwidth}{LLLLLLL}
\toprule
 & Pass/fail measure & 1: Composite metric across all criteria & 2: Composite metric at criterion level & 3: Composite metric at sub-criterion level & 4: Homogeneous cells & 5: Classifier/ regression-based approach \\
\midrule
Aggregation of indicators to indices & No aggregation & High-level aggregation & Medium-level aggregation & Low-level aggregation & No aggregation & No aggregation \\
Crudeness of (sub-)indices & Not applicable, no index & Low (consists of 10 elements) & Medium to high (each criterion can be measured with multiple elements) & High (realistically each sub-criterion can only be measured with 3-4 elements) & Not applicable, no index & Not applicable, no index \\
Importance of indicator choice & Very low to low & High to medium & Medium to low & No variation & Very low to no importance & High to very high \\
Characteristics of the metric & Easy to implement; no comparison between IDPs and hosts & High variability of index likely reduces comparability across contexts & Need to define multiple indicators for each criteria & High data demands; potentially sensitive to crudeness of index & Potential challenges in defining the cells & Potential challenges in defining cut-off points and comparing across contexts \\
Exit from IDP stock & Very low by design & Dependent on indicators & Low by design & Very low by design & Very low by design & Dependent on indicators \\ 
\bottomrule
\end{tabularx}
\end{table}

## The solutions measure as a very hard measure of stock exits

For the sake of testing the validity of the simulation findings, we also compared non-displaced households to displaced households as the benchmark, switching the comparator with the assessed population.  The logic is that host communities should exit the stock as they perform significantly better. However, when doing this recoding, we still find very similar patterns across metric options with few "fictive exits from the stock". This suggests that our findings detect that certain metric options are difficult to pass *by design* (independent of the status as host or IDP household). A simple probabilistic argument can be used to explain why this is the case. Assume, for example, that the benchmark values for the first three indicators in the assessment framework were 49%, 18%, and 82%, respectively. Then the probability of a randomly selected host community household performing better than the benchmark on the first indicator is 49%. Their probability of performing better than the benchmark on the first two indicators is 49% * 18% = 8.82%. And the probability of performing better than the benchmark on all three indicators is 49% * 18% * 82% = 7.23% . Extend the calculation to all nine indicators in the assessment framework and it becomes easy to see how the probabilities become diminishingly small. Overall, the median probability of a host community member meeting the IRIS requirement of outperforming the benchmark value on all sub-criteria simultaneously is less than 5% in the four contexts considered.  And if the IRIS requirements to score a pass on the solutions measure are so unlikely to be met by host community members, then they are doubly so for the more vulnerable IDPs.

### Testing the validity of the solutions measure 

The restrictiveness of the IRIS requirement is already apparent in the simulation results of the metric options that either fully (i.e., composite measure at the sub-criterion level, and the homogeneous cells approach) or partially (i.e., composite measure at the criterion level) comply with the requirement that all 10 sub-criteria must be passed. To provide additional evidence on the validity of the solutions measure, it makes sense to test to what extent the solutions measure is consistent with other well-established measures of living standards and well-being. The most widely recognized one being monetary poverty which serves as a strong proxy for the overall living conditions of a household. Hence, the simulations were rerun on the three datasets that include per capita income/expenditure data to explore if host community households in upper wealth quintiles score better on the solutions measure than the average benchmark. 

Figure \ref{fig:wealth} demonstrates the share of host communities that perform better than the benchmark by wealth quintiles for the two metric options that fully implement the IRIS requirement of a pass on all 10 sub-criteria. The results suggest that it is not the case that wealth host community households score well on the solutions measure. In Colombia, Nigeria, and Sudan, less than 5% of the wealthiest host community households would also meet the IRIS requirement under either of the metric options. 

\bigskip

![Share of host community households that perform better than the benchmark by wealth quintile for option 3+4 \label{fig:wealth}](plots/wealth.png){ width=75% } 

From this test, it becomes clear that there is no consistent relationship between the measure of living standards using monetary poverty and the IRIS solutions measure. 
If this comparison between the solutions measure and the wealth quintiles is implemented for the composite measure at the criterion, which only partially complies with the IRIS requirements, the results are similar but slightly less restrictive (see Figure \ref{fig:wealth_2}). Households in Nigeria and Sudan continue to demonstrate no clear association between wealth and the proposed IRIS metirc. Meanwhile, in the case of Colombia, relaxing the IRIS requirement allows the expected relation between wealth and solutions to manifest. 

![Share of host community households that perform better than the benchmark by wealth quintile for option 2 \label{fig:wealth_2}](plots/wealth_2.jpg){ width=65% } 

To sum up, the low number of exits under the metric options compliant with the IRIS requirement of achieving a pass on every single sub-criterion is because the requirement is difficult to pass by design, not due to any inherent vulnerabilities among IDP households. It should be discussed whether this standard can be relaxed to increase trust in the IRIS solutions measure and to allow plausible numbers of IDPs to exit the stock. Possible options include to focus on the composite indices at the criterion level but the simulations suggest that this metric will not perform equally well across different contexts (compare the results of Colombia to the other two countries) and that this metric raises the question of how to weigh the sub-criteria within the criteria.

# Findings on the selection of indicators

The country-by-country reporting on the effect of indicator selection on the exit of IDPs from the stock demonstrates that the indicator selection matters for some metric options more than for others. It is notable that indicators for property restitution and compensation had the strongest effect on the overall exit. Furthermore, indicators with high data missingness also significantly reduced the exit of IDPs from the stock. The following sections hence discuss in more detail - and provide additional evidence - how to address the sub-criterion 4.1 and data missingness to ensure consistent result of the solutions measure across indicators. Before turning to these discussion points, it is also important to note that the simulations generally indicate a need to use commonly available, standardized and high-quality indicators that maximize coverage in the IDP population. To achieve this, further clarifications and guidelines on how to aggregate data from the individual to the household leve, how to distinguish the different sub-criteria, and how to address categorical and metric indicators as opposed to binary indicators may become necessary. 


## Discussion of property restitution and compensation

Amongst other results, the simulations have shown that the choice of indicators matters the most regarding the sub-criterion *4.1 Property restitution and compensation*. This was the case in Hargeisa and Nigeria, where most indicator selections did not affect more than 1 percentage point difference in the number of IDPs exiting the stock. However, we have seen that choosing a more permissive HLP indicator can affect large percentages of the IDP stock. In the extreme case of Sudan, the property restitution indicators prevented all exits from the IDP stock. In Colombia, the dataset did not include questions on HLP rights in the habitual residence, indicating the need to cover those modules in large data collections more systematically. 

### Simulations to approach the problem of the HLP indicators

To further investigate how the access to property restitution and compensation mechanisms affect  affect the simulation results, the figures \ref{fig:hlp_har} and \ref{fig:hlp_nig} plot the simulation densities for an assessment of all 10 sub-criteria and for an assessment based on 9 sub-criteria (excluding the HLP indicators). The blue shaded curves exclude the HLP indicators; the grey shaded curves are the original assessment.

```{r hlp_hargeisa, fig.cap="\\label{fig:hlp_har}Density of simulations when including and excluding HLP indicators (Hargeisa)", out.width= "67%"}

ds_options <- 
  tribble(~label,                                ~opt,                    ~opt_nohlp,
          "Pass/fail measure",                   DS_Original_hargeisa, DS_Original_nohlp_hargeisa,
          "1: Full composite",                   DS_Option1_hargeisa,  DS_Option1_nohlp_hargeisa,
          "2: Composite at criterion level",     DS_Option2_hargeisa,  DS_Option2_nohlp_hargeisa,
          "3: Composite at sub-criterion level", DS_Option3_hargeisa,  DS_Option3_nohlp_hargeisa,
          "4: Comparison of homogenous cells",   DS_Option4_hargeisa,  DS_Option4_nohlp_hargeisa,
          "5: Classifier/regression-based",      DS_Option5_hargeisa,  DS_Option5_nohlp_hargeisa)

pmap(ds_options,
     ~ggplot(bind_rows("w/HLP" = ..2, "w/o HLP" = ..3, .id = "hlp"))+
       geom_density(aes(x = DS_perc, fill = hlp), alpha = 0.5)+
         scale_fill_manual(values=c("#999999", "dodgerblue2"))+
       geom_vline(aes(xintercept = mean_exited, color = hlp), 
                  linetype = "dashed", size = 1, color=c("#999999","dodgerblue2"),
                  data = function(x) {x %>% group_by(hlp) %>% summarize(mean_exited = mean(DS_perc))})+
       scale_x_continuous(labels = scales::label_percent())+
       theme_bw()+ 
    theme(title = element_text(size=8), 
          text = element_text(size= 8),
          axis.title = element_text(size=8))+
       labs(x = "Simulated proportion overcoming vulnerabilities", y = "Simulation density", 
            fill = NULL, color = NULL,
            title = ..1)) %>% 
  wrap_plots(ncol = 2) + plot_layout(guides = "collect") & theme(legend.position = "bottom")
```


```{r hlp_nigeria, fig.cap="\\label{fig:hlp_nig}Density of simulations when including and excluding HLP indicators (Nigeria)", out.width= "67%"}


ds_options_n <- 
  tribble(~label,                                ~opt,                    ~opt_nohlp,
          "Pass/fail measure",                   DS_Original_nigeria, DS_Original_nohlp_nigeria,
          "1: Full composite",                   DS_Option1_nigeria,  DS_Option1_nohlp_nigeria,
          "2: Composite at criterion level",     DS_Option2_nigeria,  DS_Option2_nohlp_nigeria,
          "3: Composite at sub-criterion level", DS_Option3_nigeria,  DS_Option3_nohlp_nigeria,
          "4: Comparison of homogenous cells",   DS_Option4_nigeria,  DS_Option4_nohlp_nigeria,
          "5: Classifier/regression-based",      DS_Option5_nigeria,  DS_Option5_nohlp_nigeria)


pmap(ds_options_n,
     ~ggplot(bind_rows("w/HLP" = ..2, "w/o HLP" = ..3, .id = "hlp"))+
       geom_density(aes(x = DS_perc, fill = hlp), alpha = 0.5)+
         scale_fill_manual(values=c("#999999", "dodgerblue2"))+
       geom_vline(aes(xintercept = mean_exited, color = hlp), 
                  linetype = "dashed", size = 1, color=c("#999999","dodgerblue2"),
                  data = function(x) {x %>% group_by(hlp) %>% summarize(mean_exited = mean(DS_perc))})+
       scale_x_continuous(labels = scales::label_percent())+
       theme_bw()+ 
    theme(title = element_text(size=8), 
          text = element_text(size= 8),
          axis.title = element_text(size=8))+
       labs(x = "Simulated proportion overcoming vulnerabilities", y = "Simulation density", 
            fill = NULL, color = NULL,
            title = ..1)) %>% 
  wrap_plots(ncol = 2) + plot_layout(guides = "collect") & theme(legend.position = "bottom")
```

There are several important insights to gain from these plots: First, the dashed vertical lines represent the mean percentage of IDPs exiting the stock. Across both displacement contexts, one can observe that the mean exit from the IDP stock is higher if the HLP indicators are excluded from the assessment. This means that, overall, there seems to be little access to property rights restitution or compensation mechanisms in the assessed displacement contexts. If HLP indicators are then included in the assessment, very few IDPs can pass the bar and can be considered as no longer suffering from key-displacement related vulnerabilities. Only assessing the other 9 dimensions is more permissive.

Related to this, excluding HLP indicators also has an effect on the different composite measures assessed in this study (options 1, 2, and 3). From the plots, we can see that the distribution of simulations moves towards the right (more IDPs exiting the stock) and we can observe more variation across indicators. This is the clearest in the composite metric at the sub-criterion level. While the original assessment based on all 10 sub-criteria did not yield any variation, we find more variation if the HLP indicators are excluded as too restrictive. In Hargeisa and Nigeria, removing the HLP indicator also "solves the problem" of a bimodal distribution for the regression-based approach. If the HLP dimension is ignored, the distribution resemble more a uniform distribution. 

### Covering property restitution and compensation in the solutions measure

For the purpose of providing guidance on the further development of the IRIS "solutions measure", the lesson learnt from this assessment is two-folded: First, the policy community should be aware that HLP rights are critical and are often lacking for IDPs. They are crucial and must be monitored to give IDPs the possibility to overcome their vulnerabilities and return to their own property and housing. However, for a statistical assessment how many IDPs overcome displacement-related vulnerabilities, the presence  of restitution and compensation mechanisms is a very high bar that effectively hinders that IDPs can be taken out of the stock. One consideration could be to assess the IDP stock without the sub-criterion *4.1. Property restitution and compensation* and to engage in separate but important policy work to ensure that IDPs can regain or prove their property after displacement.

The second lesson learnt is that if *4.1. Property restitution and compensation* is to remain part of the "solutions measure", an indicator should be chosen that can plausibly be achieved by IDP households. A key issue with examining access to restitution or compensation mechanisms is that this is only relevant if such mechanisms are in place. This is only the case in a limited number of cases across the world, and even where those mechanisms exist, there are issues in terms of equitable access to them and their effectiveness. Hence, a conceptual shift towards security of tenure might be more applicable in humanitarian and development concepts. 
For example, secured ownership over the current housing, absence of fear of eviction, or having proof for housing, land, and property in the form of documentation are more easily achievable indicators than access to formal restitution processes. 


## Missing data in the indicators

A key problem that explains why some indicator combinations yield higher exits from the stock than other combinations is rooted in the problem of missing data. IRIS provides that *"[t]here may be situations where data are not available for all criteria or sub-criteria. In this case the composite measure cannot be fully implemented and a complete assessment cannot be made about whether or [not] the population has overcome key-displacement related vulnerabilities"* (IRIS, para. 168). In other words, IDP households remain in the stock if data is missing on one of the 10 sub-criteria. In particular in the simulations in Colombia, this conservative approach can explain why many IDP households that perform reasonably well stay in the stock. This strict approach may exclude sizeable portions of the IDP population from ever being assessed for durable solutions. On average across the simulations, 29.21% of IDP households cannot be assessed and remain in the IDP stock because of definitional issues rather than specific vulnerabilities (see Figure  \ref{fig:na}for a country-level break down). Hence, it is important to assess how to best deal with missing data. 

![Distribution of missing data across indicator combinations \label{fig:na}](plots/data_missingness.png){ width=65% }

### Data missingness due to design and non-response

Missing values normally enter survey datasets through one of two channels: (i) *by design*, i.e. when a question is not administered to a certain respondent based on the questionnaire’s skip-logic; and (ii) *due to non-response*, which happens when the respondent declines to answer a certain question for any reason. The former is a common design feature of most survey datasets and not a technical problem per se. The latter can be a source of bias if the likelihood of non-response is systematically correlated with individual characteristics, but it is negligible in most cases. Yet, IRIS makes no distinction between the two even though 4 of the 10 solutions measure assessment criteria introduce missing values into the assessment by design (see \ref{tab:missing}). For example, a questionnaire skips questions around education for childless IDP households since their educational vulnerability is undefined.  

\begin{table}[!htp]
\caption{\label{tab:missing}Data missingness by design in the solutions measure}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{lX}
\toprule
Sub-criteria & Missing values by design \\
\midrule
 1.1 Victims of violence & \\
 1.2 Freedom of movement & \\
 2.1 Food security & \\
 2.2 Shelter and housing & \\
 2.3 Medical services &  Only asked to households that have medical needs within a reference period \\
 2.4 Education & Only asked to households with school-age children/youth\\
3.1 Employment and livelihoods & Only asked to households with working-age members participating in labor force \\
3.2 Economic security & \\
4.1 Property restitution  \& compensation & Only asked to households that owned property prior to displacement \\
5.1 Documentation & \\
\bottomrule
\end{tabularx}
\end{table}

### Options for dealing with missing data

Having established that missing data impedes the application of the IRIS solutions measure for a substantial portion of IDP households, the question becomes how to deal with this challenge. Three techniques are commonly employed in the statistical literature for handling missing data.

+ The most basic approach is to conduct **complete case analysis**. This entails maintaining the IRIS approach of only assessing households with no missing information while extrapolating the share of assessed IDPs exiting the stock to the full IDP population. While the approach is conceptually simple and stays true to the wording of the IRIS, the validity of the calculation rests on the assumption that the data are missing completely at random – i.e., that the characteristics of households with missing data are no different from those for whom complete data is available. This is clearly not the case here where questionnaire skip-logic creates missing data patterns that vary systematically based on respondent household characteristics. 
+ A variation of the complete-case analysis, which is only applicable for the homogeneous cell approach, is **available-case analysis**. One could calculate cell-wise indicator averages based on the households with non-missing data for the respective indicator only. This means that different indicators will be calculated based on different subsets of households within each cell thereby allowing households with missing data to exit the stock if the whole cell performs better on average than the host population benchmarks. The downside of this method is that it only works for a single metric option and makes the same missing at random assumption as complete-case analysis. 
+ The third option to deal with missing data is **imputation** or the idea to infer plausible values for missing data points which could have been observed were the data not missing. Imputation comes with its own set of challenges. First is whether to impute the missing raw survey data or the derived binary solutions indicator. If the former, there is nothing FDP-specific about the procedure to justify its standardization in IRIS and the issue is best left for NSOs to apply the methods they deem appropriate. Second, how would the uncertainty introduced by the imputation process be reflected in the final estimate of IDPs exiting the stock? Third, and most importantly, is the difficulty of interpreting implausible imputations. To continue with the running example, what would it mean to impute a "no pass" on the education criterion for a childless household? Another challenge with imputation is that it adds analytical complexity, which will make the solutions measure more difficult to apply for low-capacity NSOs.
+ Finally, EGRIS may simply opt to **reinterpret missing values as the absence of vulnerability**. The idea finds justification in the fact that a household with no school-aged children cannot experience education-related vulnerabilities. This is essentially a reversal of the IRIS approach: whereas IRIS can be seen as implicitly replacing missing data points with a "no pass" to prevent IDP households from exiting the stock, this approach would basically assign IDP households a "pass" on the missing indicators to allow them to be assessed on the other indicators for which data is available. 

### Simulations to approach the problem of missing data

To arrive at an evidence-informed decision on the way forward, the simulations were re-run by reinterpreting missing values as the absence of vulnerability. A complete case analysis does not allow to assess all IDP households, available-case analysis is only an option for homogeneous cells, and data imputation can take many - often complex - forms. Hence, the focus is here on discussing the impact of treating missing data as absence of vulnerability. 

\begin{table}[!htp]
\caption{\label{tab:missing_country}Average percentage of IDPs exiting the stock across metric and indicator combinations}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{lXXX}
\toprule
Dataset & Missing (average) & Original IRIS approach & Missing as not vulnerable \\
\midrule
Colombia &	62.30\% &	13.55\%&	31.72\% \\
Sudan	& 27.63\%	& 10.70\% &	15.00\% \\
Hargeisa &	17.10\%	& 14.43\%	& 17.47\% \\
Nigeria	& 9.80\%	& 17.69\% &	19.68\% \\
\midrule
Average	& 29.21\%	& 14.09\% &	20.97\% \\
\bottomrule
\end{tabularx}
\end{table}


Table \ref{tab:missing_country} shows that assessing IDP households that would be excluded under the current IRIS framework because of data missingness by design increases the number of IDPs exiting the stock across all displacement contexts. The greater the share of missing data, the larger the increase in IDP exits. This finding is also consistent across metric options (see Table \ref{tab:missing_metric}). Figure \ref{fig:na_colombia} shows how the distribution of IDP exits shifts if missing data is defined as not vulnerable in the context of Colombia (as the country with the highest proportion of data missingness in the sample).

![Distribution of IDP households exiting the stock in Colombia depending on missing data strategy \label{fig:na_colombia}](plots/colombia_missingness.png){ width=80% }

\begin{table}[!htp]
\caption{\label{tab:missing_metric}Average percentage of IDPs exiting the stock across dataset and indicator combinations}
\centering
\footnotesize
\begin{tabularx}{\textwidth}{lXX}
\toprule
Metric & Original IRIS approach & Missing as not vulnerable \\
\midrule
1: Full composite	& 32.68\% &	48.78\% \\
2: Composite at criterion level &	13.15\% &	20.20\% \\
3: Composite at sub-criterion level	& 2.07\%	&6.48\% \\
4: Comparison of homogeneous cells &	0.32\%	& 0.32\% \\
5: Classifier/regression-based &	34.56\%	& 46.91\% \\
\bottomrule
\end{tabularx}
\end{table}


The metric showing the highest increase (in relative terms) is the composite index at sub-criterion level. Since this option requires the aggregation of multiple indicators per sub-criterion, the presence of missing data in any of those indicators would automatically exclude the household from assessment under original IRIS approach. Reinterpreting missing data as the absence of vulnerability would allow all households in the stock to be assessed resulting in a three-fold increase in the exit rate for this metric option. 

In order to advance the work on the formulation of the solutions measure, it is overall advisable to distinguish more clearly between data that is missing by design and data that is missing due to non-response. Data missing due to non-response could be explicitly left to the national statistical offices to apply their missing data treatment procedures. In the absence of such procedures, or where certain households continue to have missing data after the application of said procedures, then those households should be excluded from assessment under the solutions measure as IRIS already specifies. For data missing by design, it should be reconsidered and clarified whether missing data entries due to skip patterns and non-applicability should be interpreted as the absence of vulnerability. 

## Data aggregation from the individual to the household level

Related to the problem of missing data is the fact that some of the sub-criteria are more naturally measured on the individual-level than the household-level. For example, employment is easiest to assess on the individual-level. To make a meaningful assessment of the household-level exit of IDPs from the overall stock, it should be made clear how data collected from individual respondents can be aggregated to the household leve. In the example of employment, it would be necessary to provide a manual to compilers of official statistics on whether a solution is achieved if at least one household member is employed, where appropriate. 

## Solution-oriented non-binary indicators

The current simulations are based on binary indicators that point out whether a household has achieved a solution or not. However, the Durable Solutions Library outlines a number of categorical and numeric variables that could be used to make a durable solutions profiling. For the purpose of the statistical metric to exit IDPs from the official stock, it is hence relevant to clearly identify hot to treat metric and categorical indicators. For example, IDP profiling exercises may collect data on the employment sector of IDPs. However, whether IDP households generate income from work in the agricultural sector or the service sector does no indicator that easily translates into the question what constitutes a solution and what does not. Hence, the selection of final indicators should make clear how the selected statistical indicators translate into solutions to displacement and how the different sub-criteria are distinct from each other. 


# Limitations and methodological concerns

This note set out to provide evidence to what extent the choice of a set of statistical indicators to measure solutions ("challenge 1") and the choice of a method to combine these indicators into one statistical metric ("challenge 2") affect a "solutions measure" for internal displacement. While the next sections will summarize the key insights from this assessment, it is important to acknowledge some key limitation in this simulation study: 
  
  1. **Sample:** Only four datasets were used to test the solutions measure due to time constraints. The coverage includes three household-level IDP profiling exercises that compare IDPs to the host community. This was complemented with a nation-wide survey that compares to the national overage. Given limited data and time, the surveys were not specifically selected to diversify context or policy relevance.  Main issues with the selection are that no data from IDP contexts with a natural disaster are used, most datasets are not necessarily nationally representative or do not cover a large proportion of the IDP population, and most data collections were not part of an exercise to generate official statistics or feed into SDG reporting. Future assessments should identify other displacement contexts and samples that may be useful to analyze with the IRIS solution measure in mind.
2. **Data quality:** While the datasets were useful because they included multiple indicators that could be used to operationalize the IRIS solutions measure, there are some concerns about data quality, in particular in terms of comparability across contexts. Additionally, the survey in Hargeisa included more significant data gaps related to the employment of respondents. In Sudan, no indicator for the freedom to move was included, the assessment did not include grouping variables that could be relevant for this simulation exercise and some indicators had to be aggregated from the household member level to the overall household. The Colombia dataset had a range of sub-criteria that were either not covered (e.g. freedom to move and HLP rights in habitual residence) or only covered with few indicators. Many indicators also had to be aggregated from the individual to the household level without clarity how this aggregation should be done. Hence, after some methodological decisions are made, reassessing how the imporved solutions measure behaves in those contexts seems crucial.
3. **Compliance with standards:** Another concern is that indicators coded from any of the three datasets to measure the 10 sub-criteria are not necessarily in full compliance with SDG indicators. For the solutions measure, it would be beneficial to streamline the elements needed to form a solutions measure with SDG indicators, to increase the likelihood that indicators are already available in various displacement contexts, to increase comparability across contexts, and to reduce the needs to collect new data in order to implement the IRIS solutions measure. Future analyses could define a set of potential indicators guided by more statistical standards and good practices. 
2. **Analysis:** Ideally, the work on operationalizing the relevant sub-criteria from the IRIS solutions metric would be done in close cooperation with different experts and organizations to ensure that the work aligns with other efforts, to be guided by statistical standards and common practices, to allow more context-specific knowledge and to cross-compare simulation results as the way statistical indicators are defined may vary depending on the coder. Additionally, the analysis had to retrofit potential indicators for the solutions measure from existing datasets. This is problematic as the indicators are hence not necessarily standardized and there are not always enough indicators to compare thoroughly. Options for future analyses include to fully simulate theoretical data on how much indicators matter in different metric options or to use datasets that are pre-designed for this methodological assessment. 

# Conclusions and key recommendations

## Informing the selection of a metric

The simulations demonstrate that the selection of a metric to implement the comparison between IDPs to a national/host community average is crucial and is the first and main problem to address as the 5 proposed metric options perform very differently. How the 10 different sub-criteria are combined and compared to a comparator population drives more of the variation than the exact definition of each statistical indicator. 

Option 1, a composite metric across all criteria, has shown high variability in the simulation. This means that this way of combining the indicators and comparing one score to the host population is very sensitive to the indicators chosen. This is largely because a composite metrics across all criteria  violates the IRIS principle that all sub-criteria must be met and cannot guarantee that IDP households overcome all key displacement-related vulnerabilities. 

Option 2, a composite measure at the criterion level, has merits as it is not overly sensitive to the choice of indicators in the composite metrics at the criterion level. However, it is necessary to define enough indicators for each criterion to ensure that the indices are not too crude. This increases the data demands to implement these options. Furthermore, EGRIS would have to provide further details on the weighting of different indicators and criteria. More evidence on the performance across different displacement contexts may also be needed. 

Option 3, a composite measure at the criterion level,  is based on a similar approach as option 2 but is focused on indices on the sub-criterion level. This yielded no to very little variation in the results as very few IDPs were classified as exiting the stock. Moreover, option 3 will often be infeasible in practical terms as the datasets used simply do not contain enough indicators to fully implement indices at the sub-criterion level. Option 3 is a very hard bar to pass for IDP households to be able to exit the stock. 

The recommendation is that further analysis and better data is needed to first fully implement these two composite metrics and to then assess how they behave comparatively. A first indication is that a composite metric at the criterion level may be more realistic although it also violates the IRIS principle that all sub-criteria must be met. 

The simulations also assessed whether a division of the IDP stock into sub-groups that can then be compared to the host population may be a feasible option (option 4). On the one hand, the homogeneous cell approach is easy to implement, comes with manageable data needs, is relatively straightforward to communicate, and does not appear overly sensitive to indicator choice. On the other hand, it might be sensitive to how the IDP population is divided into cells. This assessment did not find any stark differences between different ways of dividing the IDP stock into cells. Nevertheless, more analysis is needed to be sure and clear guidance would need to be developed by EGRIS for producers of IDP statistics on how to segment the population under analysis into smaller cells while maintaining cross-context comparability. The datasets used in this assessment were not designed with grouping variables in mind which should be considered more theoretically before making a final decision. Another disadvantage of the homogeneous cells approach is that the bar for IDP cells to exit the stock is very high by design. 

Eventually, it may also be possible to use a regression-based approach classifying IDP households as being more similar or dissimilar with other IDP households and the host community. However, this approach is highly sensitive to the indicator selection, with the highest variability across indicator combinations. Similar to option 1, it is not necessarily advisable to use one regression-based approach because: (a) it violates the IRIS principle that all sub-criteria must be met, (b) it is sensitive to the indicator selection, and (c) it might be difficult to compare different displacement situations. This option requires further methodological work to assess how the choice of a probability cut-off point, and the choice of a classifying framework affect the results. Further work is also needed to investigate how the regression coefficients for the 10 different sub-criteria may vary across contexts and how this affects the comparability between countries and displacement situations.

The report highlights key characteristics of each metric options to enable EGRIS to narrow down the possibilities as a crucial next step in the development of a fully applicable solutions measure. 


## Informing the selection of indicators

Regarding the selection of indicators, the first insight from this simulation study is that the **choice of a set of indicators to measure the 10 sub-criteria may matter less than the data quality and the metric chosen to combine these indicators**. On average across all simulations and metric options, very few indicators had a large effect on the exit of IDPs from the stock (except for HLP indicators). This finding may facilitate and de-politicize the debate as EGRIS moves towards defining concrete statistical indicators against the IASC (sub-)criteria of the solutions measure. However, as discussed in a separate section, the selection of suitable HLP indicators is crucial to develop a robust "solutions measure".

The process of running the simulations re-emphasized the quality standards IRIS already promotes for the statistical indicators for a solutions measure: It is indeed crucial that indicators are commonly used, tested and evaluated and cover the population in question. A next step for EGRIS could be to identify a **clear list of common and standardized indicators on the household level** that are already covered in many surveys. This list of indicators should be as much standardized as possible, for example by using the SDG indicators rather than other indicators. Finally, a preference should be given to indicators that commonly have high response rates and few missing values. This list could narrow down the discussions around potential indicators and advance the discussions around the solutions measure. 

When narrowing down the indicator options, EGRIS should consider how individual-level indicators - such as education, employment, etc. - translate into household-level indicators. Clear guidance should be provided on the **aggregation to the household-level** as the main basis for the solutions assessments promoted in the international recommendations. 

It is also important that EGRIS develops **clear guidelines on dealing with missing data by design**. The simulations revealed that missingness because indicators do not apply for certain IDP households should be dealt with as a large proportion of the IDP population cannot be assessed and cannot exit the stock due to "presumed" vulnerabilities. For example, a household without school-age children should be able to exit the stock as not being vulnerable on the sub-criterion for education. 

**Many potential indicators found in the Durable Solutions library are unclear regarding the question what constitutes a durable solution and what not**. For example, in which sectors households are employed (e.g. agriculture) does not provide any information whether this household overcomes displacement-related vulnerabilities or not. Nevertheless, the Durable Solutions library suggest to analyse the proportion of the IDP population working in self-employment or in work that requires seasonal movements. Another indicator suggests to look at access to agricultural land for agricultural IDP groups - but those indicators do not give a clear indication what a solution looks like for IDPs that are not self-employed, do not move for work or do not need agricultural land. It would hence be crucial to formulate the indicators to implement the "solutions measure" in a **solution-oriented** way (e.g 'Target population experiencing no security incidents' as opposed to 'Target population who think it likely they will experience serious consequences due to hazard.') and to focus on a clear concept how a solution should look like for the final indicator selection. This is particularly important for potential categorical indicators. If EGRIS selects non-binary indicators for the solutions measure, clear guidance on how to deal with such indicators will be necessary.  

Finally, the indicator choice across all simulations seemed to matter the most for the sub-criterion *4.1. Property restitution and compensation*. This was the case across displacement contexts (Hargeisa, Nigeria, Sudan) and across metric options. Given that 4.1. is a rights-based indicator, it seems crucial to decide whether these indicators should be measured based on factual compensation, based on access to compensation mechanism or only documentation of property rights. An alternative is to take out HLP rights from the durable solutions assessment and monitor them in separate work streams or to focus on security of tenure. Once this decision is made, the variation found across metrics may be drastically diminished. The assessment suggests as lessons learnt that the assessment of restitution and compensation should either be separate of the 'solutions measure' (excluding this dimension from the 10 sub-criteria) or to identify realistic and permissive indicators to mitigate that the property indicators are a very high bar to pass. 

Box \ref{box:summary} provides an overview of the key findings and recommendations. At least 7 challenges remain in turning the IRIS solutions measure into a fully workable and robust statistical metric. This note explored only the first two of these challenges. The other challenges will also need to be discussed. 

\begin{story}[t!]
\framedbox{
\footnotesize
\textbf{\textcolor{DodgerBlue!50!Black}{Metric selection}}
\begin{itemize}
\item Concerns about one full composite metric (option 1) and a regression-based approach (option 5) due to high variability and lack of alignment with IRIS principle of achieving a solution in each (sub-)criteria 
\item  Excessive data demands and too little variability for composite metric at the sub-criterion level (option 3)
\item Little variability and low exits from the stock for homogeneous cells (option 4) in the current framework 
\item Further analysis needed to fully implement a composite metric at the criterion level (option 2) but promising results

\end{itemize}

\textbf{\textcolor{DodgerBlue!50!Black}{Indicator selection}}
\begin{itemize}
\item Indicator selection may matter less for aggregate outcomes than data quality and metric selection
\item Revise the guidance on data missingness and account for missingness by design in the indicator selection
\item Focus on indicators that can be easily measured/aggregated to the household level and provide guidance
\item Define the indicators as solutions-oriented and provide guidance for categorical/numeric/binary indicators
\item Focus on indicators that have high response rates and cover the IDP population
\item Focus on indicators that are commonly available in already existing data collections
\item Focus on clearly defined and standardized indicators that can be compared across contexts (e.g. SDG indicators)

\item Address the rights-based sub-criterion \textit{4.1. Property restitution and compensation} by either taking the indicator out of the assessment or by defining the indicator in terms of security of tenure
\item Clarify the distinction between \textit{3.1. Employment \& livelihoods} and \textit{3.2. Economic security} 
\end{itemize}

\textbf{\textcolor{DodgerBlue!50!Black}{Remaining challenges:}}
\begin{itemize}
\item Adress how to deal with statistical uncertainty in the target/benchmark values
\item Specify how missing data points should be dealth with
\item Define the comparator population
\item Address changing benchmark values over time
\item Specify how assistance is factored into the solutions measure
\end{itemize}

}
  \caption[]{Key conclusions and recommendations}
  \label{box:summary}
\end{story}



\newpage
\blandscape
\appendix

# Annex: Full mapping of all available indicators for the solutions measure

```{r appendix_mapping}
options(knitr.kable.NA = '')
appendix <- read_csv("Indicator_mapping.csv") %>% select(-"X7",-"X8")

kable(appendix, 
      "latex",
      booktabs=T,
      linesep = "",
      longtable = T,
      row.names = F,
      #col.names = gsub("[.]", " ", names(HAR))
      ) %>%
  kable_styling(latex_options = "hold_position", font_size=7)%>%
  column_spec(1, width = "7em")%>%
  column_spec(2, width = "18em")%>%
  column_spec(3:6, width = "16.3em") %>% 
    row_spec(c(11,12,15,29,33,38,48,61,68), hline_after = TRUE)
```

\elandscape
